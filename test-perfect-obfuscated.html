<!DOCTYPE html>
<html>
<head>
    <title>æœ€ç»ˆæ··æ·†æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .test-item { margin: 5px 0; padding: 5px; border-left: 3px solid #ddd; }
        #codePreview { 
            background: #f8f8f8; 
            border: 1px solid #ddd; 
            padding: 10px; 
            margin: 10px 0; 
            font-family: monospace; 
            white-space: pre-wrap; 
            max-height: 300px; 
            overflow: auto; 
        }
    </style>
</head>
<body>
    <h1>æœ€ç»ˆæ··æ·†æµ‹è¯•</h1>
    <div class="info">
        <strong>æ–‡ä»¶ä¿¡æ¯:</strong><br>
        åŸå§‹æ–‡ä»¶: 54KB<br>
        æ··æ·†å: 31KB<br>
        å‹ç¼©ç‡: 43.3%
    </div>
    
    <div id="status">æ­£åœ¨åŠ è½½å’Œæµ‹è¯•JavaScript...</div>
    <div id="testResults"></div>
    
    <script src="js-dist/calculation.perfect.js"></script>
    <script>
        function runComprehensiveTests() {
            const results = [];
            
            try {
                // æµ‹è¯•1: CalculationManageræ˜¯å¦å­˜åœ¨
                if (typeof calculationManager === 'undefined') {
                    results.push({ name: 'CalculationManager', passed: false, message: 'æœªå®šä¹‰' });
                    return results;
                }
                results.push({ name: 'CalculationManager', passed: true, message: 'å­˜åœ¨' });
                
                // æµ‹è¯•2: æ£€æŸ¥æ‰€æœ‰æ ¸å¿ƒå‡½æ•°
                const requiredFunctions = [
                    'calculateResult',
                    'calculateSCL90',
                    'calculateAnimalPersonality',
                    'calculateSpiritualNeeds',
                    'calculateWeatherPersonalityV2',
                    'calculateHollandAdapt',
                    'calculateRelationshipComfort',
                    'calculateMingDynasty',
                    'calculateCareerCompass'
                ];
                
                requiredFunctions.forEach(funcName => {
                    const func = calculationManager[funcName];
                    const passed = typeof func === 'function';
                    results.push({ 
                        name: `${funcName}`, 
                        passed,
                        message: passed ? 'å‡½æ•°å¯ç”¨' : 'å‡½æ•°ä¸å­˜åœ¨æˆ–ä¸æ˜¯å‡½æ•°'
                    });
                });
                
                // æµ‹è¯•3: æ‰§è¡ŒcalculateSCL90ï¼ˆé‡ç‚¹æµ‹è¯•ï¼‰
                try {
                    // åˆ›å»ºæµ‹è¯•æ•°æ®
                    const testData = {
                        dimensions: {
                            anxiety: { 
                                name: 'ç„¦è™‘',
                                items: [1, 2, 3],
                                highDescription: 'é«˜ç„¦è™‘',
                                lowDescription: 'ä½ç„¦è™‘',
                                interpretation: 'ç„¦è™‘å› å­è§£é‡Š',
                                scoreRange: [0, 4],
                                threshold: 2.0
                            }
                        },
                        questions: [
                            { 
                                options: [
                                    { id: 'A', score: 1 },
                                    { id: 'B', score: 2 }
                                ]
                            },
                            { 
                                options: [
                                    { id: 'A', score: 1 },
                                    { id: 'B', score: 2 }
                                ]
                            },
                            { 
                                options: [
                                    { id: 'A', score: 1 },
                                    { id: 'B', score: 2 }
                                ]
                            }
                        ]
                    };
                    
                    const answers = ['A', 'B', 'A'];
                    const result = calculationManager.calculateSCL90(answers, testData);
                    
                    results.push({ 
                        name: 'calculateSCL90æ‰§è¡Œ', 
                        passed: true,
                        message: `æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›testType: ${result.testType || 'æœªçŸ¥'}`
                    });
                    
                    // æµ‹è¯•4: æ£€æŸ¥è¿”å›ç»“æœç»“æ„
                    const requiredProps = ['score', 'totalScore', 'testType', 'dimensions'];
                    requiredProps.forEach(prop => {
                        const hasProp = prop in result;
                        results.push({
                            name: `ç»“æœåŒ…å«${prop}`,
                            passed: hasProp,
                            message: hasProp ? 'å­˜åœ¨' : 'ç¼ºå¤±'
                        });
                    });
                    
                } catch (e) {
                    results.push({ 
                        name: 'calculateSCL90æ‰§è¡Œ', 
                        passed: false,
                        message: 'æ‰§è¡Œé”™è¯¯: ' + e.message + ' (è¡Œå·: ' + (e.lineNumber || 'æœªçŸ¥') + ')'
                    });
                }
                
                // æµ‹è¯•5: æµ‹è¯•å…¶ä»–å‡½æ•°
                try {
                    const animalResult = calculationManager.calculateAnimalPersonality(['A', 'B', 'C']);
                    results.push({
                        name: 'calculateAnimalPersonality',
                        passed: true,
                        message: `æ‰§è¡ŒæˆåŠŸï¼ŒåŠ¨ç‰©: ${animalResult.animal || 'æœªçŸ¥'}`
                    });
                } catch (e) {
                    results.push({
                        name: 'calculateAnimalPersonality',
                        passed: false,
                        message: 'é”™è¯¯: ' + e.message
                    });
                }
                
            } catch (error) {
                results.push({ 
                    name: 'æ•´ä½“æµ‹è¯•', 
                    passed: false, 
                    message: 'æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: ' + error.message 
                });
            }
            
            return results;
        }
        
        // æ‰§è¡Œæµ‹è¯•
        setTimeout(() => {
            const statusEl = document.getElementById('status');
            const testResultsEl = document.getElementById('testResults');
            
            statusEl.innerHTML = 'æ­£åœ¨æ‰§è¡Œæµ‹è¯•...';
            
            setTimeout(() => {
                const testResults = runComprehensiveTests();
                
                let allPassed = true;
                let html = '<h3>è¯¦ç»†æµ‹è¯•ç»“æœ:</h3>';
                
                testResults.forEach(result => {
                    allPassed = allPassed && result.passed;
                    html += `<div class="test-item" style="border-color: ${result.passed ? 'green' : 'red'}">
                        ${result.passed ? 'âœ…' : 'âŒ'} <strong>${result.name}</strong>
                        ${result.message ? ' - ' + result.message : ''}
                    </div>`;
                });
                
                testResultsEl.innerHTML = html;
                
                if (allPassed) {
                    statusEl.innerHTML = '<span class="success">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ··æ·†ä»£ç å®Œå…¨å¯ç”¨ã€‚</span>';
                    console.log('âœ… æ··æ·†æµ‹è¯•å®Œæˆï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼');
                } else {
                    statusEl.innerHTML = '<span class="error">âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥æ··æ·†é€»è¾‘ã€‚</span>';
                    console.warn('âš ï¸  éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œæ£€æŸ¥ä¸Šé¢çš„é”™è¯¯ä¿¡æ¯');
                }
                
                // æ˜¾ç¤ºéƒ¨åˆ†æ··æ·†ä»£ç 
                const codePreview = document.createElement('div');
                codePreview.id = 'codePreview';
                codePreview.innerHTML = '<h4>æ··æ·†åä»£ç ç‰‡æ®µï¼ˆå‰500å­—ç¬¦ï¼‰:</h4>';
                
                // è·å–æ··æ·†ä»£ç ç‰‡æ®µ
                const xhr = new XMLHttpRequest();
                xhr.open('GET', 'js-dist/calculation.perfect.js', true);
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        const code = xhr.responseText;
                        codePreview.innerHTML += '<pre>' + code.substring(0, 500) + '...</pre>';
                    }
                };
                xhr.send();
                
                document.body.appendChild(codePreview);
                
            }, 100);
        }, 100);
    </script>
</body>
</html>