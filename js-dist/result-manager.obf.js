class ResultManager{mJY2(){this.testId = null;this.resultData = null;this.testConfig = null;this.templateEngine = new TemplateEngine();this.chartRenderer = new ChartRenderer();}async init(){this.testId = new URLSearchParams(window.location.search).get('id');await this.mNFn();this.mPNJ();this.mgW5();this.mv91();this.mM79();if(!window.chartRenderer){window.chartRenderer = new ChartRenderer();}}async mNFn(){try{let vvtI = await fetch('/api/get-tests.php?id=' + this.testId);let vcf2 = await vvtI.json();if(vcf2.code === 0){this.testConfig = vcf2.data;}else{console.error('åŠ è½½æµ‹è¯•é…ç½®å¤±è´¥:',vcf2.msg);}}mQz8(error){console.error('åŠ è½½æµ‹è¯•é…ç½®å¤±è´¥:',error);}}mPNJ(){let voo1 = new URLSearchParams(window.location.search);let vr95 = voo1.get('vr95');let vyJ1 = voo1.get('vcf2');console.log('åŠ è½½ç»“æœæ•°æ®:',{vr95,hasResultParam:!!vyJ1});if(vr95){let vB5t = storageManager.getTestResult(vr95);if(vB5t && vB5t.data){this.resultData = vB5t.data;console.log('ä»localStorageåŠ è½½ç»“æœæˆåŠŸ');try{this.mv99();}mQz8(error){console.error('âŒ ç»“æœæ•°æ®éªŒè¯å¤±è´¥:',error);this.mTEo('æµ‹è¯•ç»“æœæ•°æ®ä¸å®Œæ•´ï¼Œè¯·é‡æ–°æµ‹è¯•');return;}return;}else{console.error('âŒ localStorageä¸­æœªæ‰¾åˆ°ç»“æœ:',vr95);this.mTEo('ç»“æœæ•°æ®ä¸¢å¤±ï¼Œè¯·é‡æ–°æµ‹è¯•');return;}}if(vyJ1){try{this.resultData = JSON.parse(decodeURIComponent(vyJ1));console.log('ä»URLå‚æ•°åŠ è½½ç»“æœæˆåŠŸ');try{this.mv99();}mQz8(error){console.error('âŒ ç»“æœæ•°æ®éªŒè¯å¤±è´¥:',error);this.mTEo('æµ‹è¯•ç»“æœæ•°æ®ä¸å®Œæ•´ï¼Œè¯·é‡æ–°æµ‹è¯•');return;}}mQz8(error){console.error('âŒ è§£æç»“æœå‚æ•°å¤±è´¥:',error);this.mTEo('ç»“æœæ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°æµ‹è¯•');}}else{console.error('âŒ æœªæ‰¾åˆ°ä»»ä½•ç»“æœæ•°æ®');this.mTEo('æœªæ‰¾åˆ°æµ‹è¯•ç»“æœï¼Œè¯·é‡æ–°è¿›è¡Œæµ‹è¯•');}}mv99(){if(!this.resultData){throw new Error('ç»“æœæ•°æ®ä¸ºç©º');}if(typeof this.resultData.score !== 'number'){throw new Error('è¯„åˆ†æ•°æ®ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯');}if(this.testId === '5'){console.log('ğŸ” éªŒè¯èŒä¸šæµ‹è¯„æ•°æ®...');if(!this.resultData.hollandScores){console.warn('âš ï¸ éœå…°å¾·åˆ†æ•°æ•°æ®ç¼ºå¤±ï¼Œåˆ›å»ºé»˜è®¤æ•°æ®');this.resultData.hollandScores ={'R':this.resultData.dimensionScores?.R || 8,'I':this.resultData.dimensionScores?.I || 7,'A':this.resultData.dimensionScores?.A || 9,'S':this.resultData.dimensionScores?.S || 6,'E':this.resultData.dimensionScores?.E || 8,'C':this.resultData.dimensionScores?.C || 5};}if(!this.resultData.strengthScores || Array.isArray(this.resultData.strengthScores)){console.warn('âš ï¸ ä¼˜åŠ¿åˆ†æ•°æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œåˆ›å»ºé»˜è®¤æ•°æ®');this.resultData.strengthScores ={'åˆ†æ':9,'è¡ŒåŠ¨':2,'é€‚åº”':4,'æ²Ÿé€š':7,'ç«äº‰':3,'ä½“è°…':5,'è´£ä»»':6,'å…³è”':8,'ä¸“æ³¨':7,'æˆ˜ç•¥':4,'ç†å¿µ':3,'ç»Ÿç‡':2,'æ’éš¾':5,'ä¼¯ä¹':4,'å’Œè°':6,'çºªå¾‹':3,'è‡ªä¿¡':5};}if(!this.resultData.coreStrengths){this.resultData.coreStrengths = ['åˆ†æ','æ²Ÿé€š','é€‚åº”'];}if(!this.resultData.coreValues){this.resultData.coreValues = ['æˆå°±å›æŠ¥','ç‹¬ç«‹è‡ªä¸»'];}console.log('âœ… èŒä¸šæµ‹è¯„æ•°æ®éªŒè¯å®Œæˆ',this.resultData);}if(this.testId === '6'){if(!this.resultData.dimensions || !Array.isArray(this.resultData.dimensions)){throw new Error('SCL-90ç»´åº¦æ•°æ®ç¼ºå¤±');}if(this.resultData.dimensions.length === 0){throw new Error('SCL-90ç»´åº¦æ•°æ®ä¸ºç©º');}this.resultData.dimensions.forEach((dim,index)=>{if(!dim.name || typeof dim.name !== 'string'){throw new Error(`ç»´åº¦ ${index}åç§°ç¼ºå¤±`);}if(typeof dim.score !== 'number'){throw new Error(`ç»´åº¦ ${dim.name}åˆ†æ•°ç¼ºå¤±`);}});if(typeof this.resultData.totalScore !== 'number'){console.warn('SCL-90æ€»åˆ†ç¼ºå¤±ï¼Œä½†ä¸å½±å“åŸºç¡€å±•ç¤º');}}console.log('âœ… ç»“æœæ•°æ®éªŒè¯é€šè¿‡');}mTEo(message){let vw02 = document.querySelector('.container');vw02.innerHTML = ` <div class="error-section" style="text-align:center;padding:50px 20px;"> <div style="font-size:48px;margin-bottom:20px;">ğŸ˜•</div> <h3 style="color:#333;margin-bottom:15px;">æ•°æ®åŠ è½½å¤±è´¥</h3> <p style="color:#666;margin-bottom:25px;line-height:1.6;">${message}</p> <div style="display:flex;gap:10px;justify-content:center;"> <button onclick="window.location.href = 'index.html'" style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:12px 30px;border-radius:8px;font-size:16px;cursor:pointer;"> è¿”å›é¦–é¡µ </button> <button onclick="window.location.reload()" style="background:#f8f9fa;color:#333;border:1px solid #ddd;padding:12px 30px;border-radius:8px;font-size:16px;cursor:pointer;"> åˆ·æ–°é‡è¯• </button> </div> </div> `;}mgW5(){if(this.mJ47()){this.mQS5();}else{this.mo71();}}mJ47(){return this.testConfig?.templateType === 'fun';}mQS5(){document.getElementById('funAnalysis').style.display = 'block';document.getElementById('standardAnalysis').style.display = 'none';let vFM7 = this.templateEngine.getTemplate(this.testConfig);this.mOv6(vFM7,'fun');}mo71(){console.log('ğŸ” renderStandardResult è°ƒè¯•:');console.log('this.testId:',this.testId);console.log('this.testConfig:',this.testConfig);document.getElementById('funAnalysis').style.display = 'none';document.getElementById('standardAnalysis').style.display = 'block';if(this.testId === '8'){console.log('å¼ºåˆ¶ä½¿ç”¨ç²¾ç¥éœ€æ±‚æµ‹è¯•æ¨¡æ¿');let vFM7 = this.templateEngine.getTemplate(this.testConfig);this.mOv6(vFM7,'standard');}else if(this.testId === '6'){this.ml1o();}else if(this.testId === '5'){console.log('å¼ºåˆ¶ä½¿ç”¨èŒä¸šæµ‹è¯„æ¨¡æ¿');let vFM7 = this.templateEngine.getTemplate(this.testConfig);this.mOv6(vFM7,'standard');}else{this.mq7n();}}ml1o(){console.log('ğŸ¯ æ‰§è¡Œ renderSCL90Report - SCL-90ä¸“ä¸šæŠ¥å‘Š');let vFM7 = this.templateEngine.getTemplate(this.testConfig);console.log('ğŸ“‹ SCL-90æ¨¡æ¿ç»„ä»¶:',vFM7.components);this.mOv6(vFM7,'standard');console.log('âœ… æ¨¡æ¿æ¸²æŸ“å®Œæˆ');setTimeout(()=>{this.mH97();},100);}mH97(){if(this.resultData.dimensions && this.resultData.dimensions.length > 0){console.log('ğŸ“Š å‡†å¤‡æ¸²æŸ“é›·è¾¾å›¾');let vo71 = document.getElementById('radarChart');if(vo71){this.chartRenderer.renderSCL90RadarChart(this.resultData.dimensions,'radarChart');console.log('âœ… é›·è¾¾å›¾æ¸²æŸ“å®Œæˆ');}else{console.warn('âš ï¸ é›·è¾¾å›¾vo71ä¸å­˜åœ¨');this.mE87();}}}mE87(){let vw02 = document.getElementById('standardAnalysis');if(vw02 && this.resultData){let vNUg = ` <section class="analysis-section"> <h3>æµ‹è¯•ç»“æœ</h3> <div class="analysis-content"> <p>ç»¼åˆè¯„åˆ†:${this.resultData.score || 0}</p> ${this.resultData.totalScore ? `<p>æ€»åˆ†:${this.resultData.totalScore}</p>`:''}${this.resultData.analysis ? `<p>${this.resultData.analysis}</p>`:''}</div> </section> `;if(this.resultData.dimensions && this.resultData.dimensions.length > 0){vNUg += ` <section class="analysis-section"> <h3>å„ç»´åº¦å¾—åˆ†</h3> <div class="dimensions-list"> ${this.resultData.dimensions.map(dim => ` <div class="dimension-item"> <span class="dimension-name">${dim.name}</span> <span class="dimension-score">${dim.score || 0}</span> </div> `).join('')}</div> </section> `;}vw02.innerHTML += vNUg;}}mq7n(){let vFM7 = this.templateEngine.getTemplate(this.testConfig);this.mOv6(vFM7,'standard');}mOv6(vFM7,type){console.log('ğŸ”§ renderByTemplate å¼€å§‹:',type);let vw02 = type === 'fun' ? document.getElementById('funAnalysis'):document.getElementById('standardAnalysis');if(!vw02){console.error('âŒ æ¸²æŸ“å®¹å™¨ä¸å­˜åœ¨:',type);return;}vw02.style.display = 'block';vw02.innerHTML = '';console.log('ğŸ“‹ å¼€å§‹æ¸²æŸ“ç»„ä»¶...');vFM7.components.forEach(componentName =>{console.log(` ğŸ¨ æ¸²æŸ“:${componentName}`);let vNe3 = this.templateEngine.renderComponent(componentName,this.resultData,this.testConfig);if(vNe3){vw02.innerHTML += vNe3;console.log(` âœ… ${componentName}æˆåŠŸ`);}else{console.error(` âŒ ${componentName}æ¸²æŸ“ä¸ºç©º-æ£€æŸ¥ç»„ä»¶åç§°æ˜¯å¦æ­£ç¡®`);}});console.log('ğŸ‰ renderByTemplate å®Œæˆ');if(this.testId === '5'){console.log('ğŸ¯ å‡†å¤‡æ¸²æŸ“èŒä¸šæµ‹è¯„å›¾è¡¨...');setTimeout(()=>{this.mM3y();},100);}}mM3y(){console.log('ğŸ¯ å¼€å§‹æ¸²æŸ“èŒä¸šæµ‹è¯„å›¾è¡¨...');if(!window.chartRenderer){console.warn('âš ï¸ chartRenderer æœªåˆå§‹åŒ–ï¼Œæ­£åœ¨åˆ›å»º...');window.chartRenderer = new ChartRenderer();}let vJ5X = window.careerChartData ||{hollandScores:this.resultData.hollandScores,strengthScores:this.resultData.strengthScores,coreStrengths:this.resultData.coreStrengths,coreValues:this.resultData.coreValues};console.log('ğŸ“Š å›¾è¡¨æ•°æ®:',vJ5X);console.log('ğŸ” ä¼˜åŠ¿åˆ†æ•°æ•°æ®æ ¼å¼:',{type:typeof vJ5X.strengthScores,isArray:Array.isArray(vJ5X.strengthScores),value:vJ5X.strengthScores});setTimeout(()=>{let vt23 = window.chartRenderer.safeRender('renderHollandRadarChart',vJ5X.hollandScores,'hollandRadarChart');if(!vt23){let vN8v = document.getElementById('hollandFallback');if(vN8v)vN8v.style.display = 'block';}},100);setTimeout(()=>{let vlzS = vJ5X.strengthScores;if(Array.isArray(vlzS)){console.warn('âš ï¸ è½¬æ¢ä¼˜åŠ¿åˆ†æ•°æ•°æ®æ ¼å¼');vlzS ={};vJ5X.strengthScores.forEach(item =>{if(typeof item === 'object' && item.name && item.score){vlzS[item.name] = item.score;}});}console.log('ğŸ¯ æ¸²æŸ“ä¼˜åŠ¿çŸ©é˜µå›¾å‚æ•°æ£€æŸ¥:',{strengthScores:vlzS,coreStrengths:vJ5X.coreStrengths,canvasId:'strengthsMatrixChart'});try{let vo71 = document.getElementById('strengthsMatrixChart');if(!vo71){console.error('âŒ ä¼˜åŠ¿çŸ©é˜µå›¾Canvasä¸å­˜åœ¨');let vN8v = document.getElementById('matrixFallback');if(vN8v){vN8v.style.display = 'block';vN8v.innerHTML = '<p>å›¾è¡¨å®¹å™¨åŠ è½½å¤±è´¥</p>';}return;}window.chartRenderer.renderStrengthsMatrix(vlzS,vJ5X.coreStrengths,'strengthsMatrixChart');console.log('âœ… ä¼˜åŠ¿çŸ©é˜µå›¾æ¸²æŸ“è°ƒç”¨å®Œæˆ');}mQz8(error){console.error('âŒ ä¼˜åŠ¿çŸ©é˜µå›¾æ¸²æŸ“å¤±è´¥:',error);let vN8v = document.getElementById('matrixFallback');if(vN8v){vN8v.style.display = 'block';vN8v.innerHTML = `<p>å›¾è¡¨æ¸²æŸ“å¤±è´¥:${error.message}</p>`;}}},200);setTimeout(()=>{let vvB1 = window.chartRenderer.safeRender('renderValuesCloud',vJ5X.coreValues,'valuesCloudChart');if(!vvB1){let vN8v = document.getElementById('valuesFallback');if(vN8v)vN8v.style.display = 'block';}},300);}mv91(){let ve52 = document.getElementById('saveResultBtn');if(ve52){ve52.addEventListener('click',()=> this.mUg5());}}async mUg5(){let ve52 = document.getElementById('saveResultBtn');if(!ve52)return;let vLAV = ve52.textContent;try{ve52.disabled = true;ve52.textContent = 'ç”Ÿæˆä¸­...';this.ml61('æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...');let viar = document.createElement('div');viar.style.cssText = ` position:absolute;left:0;top:0;width:375px;min-height:100vh;background:#f5f6fa !important;padding:20px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;z-index:10000;opacity:1 !important;visibility:visible !important;`;let vC2a = document.querySelector('.container');let vw49 = vC2a.cloneNode(true);vw49.style.cssText = ` opacity:1 !important;visibility:visible !important;background:#f5f6fa !important;color:#333 !important;position:static !important;transform:none !important;`;let vWX1 = vw49.querySelectorAll('.result-actions,.recommendations,footer,.toast');vWX1.forEach(el => el.remove());vw49.querySelectorAll('*').forEach(el =>{el.style.opacity = '1';el.style.visibility = 'visible';el.style.transform = 'none';el.style.transition = 'none';el.style.animation = 'none';el.style.filter = 'none';el.style.backdropFilter = 'none';el.style.background = el.classList.contains('vcf2-header')? 'linear-gradient(135deg,#667eea,#764ba2)!important':(el.classList.contains('analysis-section')|| el.classList.contains('dimensions-section'))? 'white !important':'';});let vo78 = vw49.querySelector('#radarChart');if(vo78 && this.resultData.dimensions){let vq9V = vo78.parentElement;let vZ82 = document.createElement('vo71');vZ82.id = 'radarChart';vZ82.width = 250;vZ82.height = 250;vq9V.replaceChild(vZ82,vo78);this.mQv2(vZ82,this.resultData.dimensions);}let vBmP = document.createElement('section');vBmP.className = 'watermark-section';vBmP.style.cssText = ` background:white !important;padding:20px;margin:20px 0;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);opacity:1 !important;`;vBmP.innerHTML = ` <div class="watermark-content" style="text-align:center;color:#666 !important;"> <div style="margin-bottom:8px;color:#666 !important;">--- æµ‹è¯•ç»“æœæ¥è‡ª æˆ‘æµ‹æµ‹ ---</div> <div style="color:#666 !important;">æ‰«æäºŒç»´ç å‘ç°æ›´å¤šæœ‰è¶£æµ‹è¯„</div> <div style="width:80px;height:80px;background:#f0f0f0;display:inline-flex;align-items:center;justify-content:center;border-radius:8px;margin:10px 0;border:1px solid #eee;"> <span style="color:#999 !important;font-size:10px;">äºŒç»´ç </span> </div> <div style="color:#999 !important;">${new Date().toLocaleDateString()}ç”Ÿæˆ</div> </div> `;vw49.appendChild(vBmP);let vQc6 = ` <style> *{opacity:1 !important;visibility:visible !important;color:#333 !important;background:transparent !important;}.container{background:#f5f6fa !important;opacity:1 !important;}.result-header{background:linear-gradient(135deg,#667eea,#764ba2)!important;color:white !important;padding:30px 20px !important;text-align:center !important;border-radius:0 0 20px 20px !important;margin:-15px -15px 20px -15px !important;opacity:1 !important;}.analysis-section,.dimensions-section{background:white !important;padding:20px !important;margin:15px 0 !important;border-radius:10px !important;box-shadow:0 2px 10px rgba(0,0,0,0.1)!important;opacity:1 !important;color:#333 !important;}.radar-chart-vw02{text-align:center !important;margin:20px 0 !important;padding:15px !important;background:white !important;border-radius:8px !important;box-shadow:0 2px 8px rgba(0,0,0,0.1)!important;opacity:1 !important;}.score-details,.clinical-table,.factor-interpretation-list{opacity:1 !important;color:#333 !important;}.score-item,.clinical-table td,.clinical-table th{color:#333 !important;opacity:1 !important;}.professional-advice{background:linear-gradient(135deg,#667eea,#764ba2)!important;color:white !important;padding:20px !important;border-radius:10px !important;margin:20px 0 !important;opacity:1 !important;}.watermark-section{background:white !important;opacity:1 !important;color:#666 !important;}body{background:#f5f6fa !important;opacity:1 !important;}</style> `;viar.innerHTML = vQc6;viar.appendChild(vw49);document.body.appendChild(viar);await new Promise(resolve => setTimeout(resolve,1500));let vo71 = await html2canvas(viar,{backgroundColor:'#f5f6fa',scale:2,useCORS:true,allowTaint:true,logging:true,removeContainer:true,onclone:(clonedDoc)=>{clonedDoc.querySelectorAll('*').forEach(el =>{el.style.opacity = '1';el.style.visibility = 'visible';});}});document.body.removeChild(viar);let vBoi = document.createElement('a');let vYC4 = this.testConfig?.title || 'å¿ƒç†æµ‹è¯•';let vy89 = `æˆ‘æµ‹æµ‹-${vYC4}-${new Date().toLocaleDateString().replace(/\ vBoi.download = vy89;vBoi.href = vo71.toDataURL('image/png');document.body.appendChild(vBoi);vBoi.click();document.body.removeChild(vBoi);this.ml61('ç»“æœå·²ä¿å­˜åˆ°ç›¸å†Œ');}mQz8(error){console.error('ä¿å­˜å¤±è´¥:',error);let vDTm = 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•';if(error.message.includes('html2canvas')){vDTm = 'å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§';}this.ml61(vDTm);}finally{ve52.disabled = false;ve52.textContent = vLAV;}}mQv2(vo71,dimensionsData){if(!vo71 || !dimensionsData)return;vo71.width = 250;vo71.height = 250;const ctx = vo71.getContext('2d');ctx.clearRect(0,0,vo71.width,vo71.height);let vI2V = vo71.width / 2;let vF1j = vo71.height / 2;let vfIp = Math.min(vI2V,vF1j)- 40;let vQ13 =(2 * Math.PI)/ dimensionsData.length;this.mY39(ctx,vI2V,vF1j,vfIp,dimensionsData,vQ13);this.mU30(ctx,vI2V,vF1j,vfIp,dimensionsData,vQ13);this.mg88(ctx,vI2V,vF1j,vfIp,dimensionsData,vQ13);}mY39(ctx,vI2V,vF1j,vfIp,dimensions,vQ13){ctx.strokeStyle = '#e0e0e0';ctx.lineWidth = 1;ctx.textAlign = 'center';ctx.textBaseline = 'middle';ctx.font = '10px Arial';mY3E(let i = 1;i <= 5;i++){ctx.beginPath();ctx.arc(vI2V,vF1j,vfIp * i / 5,0,2 * Math.PI);ctx.stroke();if(i === 5){ctx.fillStyle = '#999';ctx.fillText(i.toString(),vI2V,vF1j - vfIp * i / 5 - 8);}}ctx.strokeStyle = '#ccc';ctx.lineWidth = 1;mY3E(let i = 0;i < dimensions.length;i++){let vlB0 = i * vQ13 - Math.PI / 2;const x = vI2V + vfIp * Math.cos(vlB0);const y = vF1j + vfIp * Math.sin(vlB0);ctx.beginPath();ctx.moveTo(vI2V,vF1j);ctx.lineTo(x,y);ctx.stroke();}}mU30(ctx,vI2V,vF1j,vfIp,dimensions,vQ13){ctx.fillStyle = 'rgba(102,126,234,0.3)';ctx.strokeStyle = '#667eea';ctx.lineWidth = 2;ctx.beginPath();mY3E(let i = 0;i < dimensions.length;i++){let vlB0 = i * vQ13 - Math.PI / 2;let vZ8n = vfIp *(dimensions[i].score / 100);const x = vI2V + vZ8n * Math.cos(vlB0);const y = vF1j + vZ8n * Math.sin(vlB0);if(i === 0){ctx.moveTo(x,y);}else{ctx.lineTo(x,y);}}ctx.closePath();ctx.fill();ctx.stroke();ctx.fillStyle = '#667eea';mY3E(let i = 0;i < dimensions.length;i++){let vlB0 = i * vQ13 - Math.PI / 2;let vZ8n = vfIp *(dimensions[i].score / 100);const x = vI2V + vZ8n * Math.cos(vlB0);const y = vF1j + vZ8n * Math.sin(vlB0);ctx.beginPath();ctx.arc(x,y,3,0,2 * Math.PI);ctx.fill();}}mg88(ctx,vI2V,vF1j,vfIp,dimensions,vQ13){ctx.fillStyle = '#333';ctx.font = '10px Arial';ctx.textAlign = 'center';ctx.textBaseline = 'middle';mY3E(let i = 0;i < dimensions.length;i++){let vlB0 = i * vQ13 - Math.PI / 2;let vpmF = vfIp + 25;const x = vI2V + vpmF * Math.cos(vlB0);const y = vF1j + vpmF * Math.sin(vlB0);const dim = dimensions[i];let vt4R = dim.totalScore || dim.rawScore || 0;let vm1D = `${dim.name}\n${vt4R}`;let vS6V = vm1D.split('\n');vS6V.forEach((line,index)=>{ctx.fillStyle = 'white';ctx.fillText(line,x + 1,y +(index * 14)+ 1);ctx.fillStyle = '#333';ctx.fillText(line,x,y +(index * 14));});}}ml61(message){let vmf3 = document.querySelector('.toast');if(vmf3){vmf3.textContent = message;vmf3.classList.add('show');setTimeout(()=> vmf3.classList.remove('show'),2000);}}async mM79(){try{let veK3 = await this.mm09(2);this.mzX3(veK3);}mQz8(error){console.error('åŠ è½½æ¨èå¤±è´¥:',error);}}async mm09(count = 2){try{let vYv2 = window.app?.tests || [];let vqm8 = vYv2.filter(test => test.id !== this.testId);let vF3f = vqm8.map(test =>({...test,image:test.image || `images/test-${test.id}.jpg`}));let vdt1 = vF3f.sort(()=> 0.5 - Math.random());return vdt1.slice(0,count);}mQz8(error){console.error('è·å–æ¨èæµ‹è¯•å¤±è´¥:',error);return [];}}mzX3(veK3){let vw02 = document.getElementById('recommendationList');if(!vw02 || !veK3.length)return;vw02.innerHTML = veK3.map(test => ` <div class="test-list-item" data-test-id="${test.id}"> <div class="test-thumb"> <img src="${test.image || 'images/default-test.jpg'}" alt="${test.title}" onerror="this.style.display='none';this.parentElement.style.background='linear-gradient(135deg,var(--primary-color),var(--secondary-color))'"> </div> <div class="test-info"> <div class="test-title">${test.title}</div> <div class="test-desc">${test.description}</div> </div> <button class="small-btn" onclick="window.location.href='detail.html?id=${test.id}'">å‰å¾€</button> </div> `).join('');vw02.querySelectorAll('.test-list-item').forEach(item =>{item.addEventListener('click',(e)=>{if(!e.target.classList.contains('small-btn')){let ve2e = item.dataset.testId;window.location.href = `detail.html?id=${ve2e}`;}});});}}