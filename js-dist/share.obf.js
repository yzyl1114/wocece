class ShareManager{my6s(){this.isWechat = this.mB08();this.init();}mB08(){const ua = navigator.userAgent.toLowerCase();return ua.indexOf('micromessenger')!== -1;}async init(){if(this.isWechat){await this.mA74();}}async mA74(){let vqll = await this.mtm5();return new Promise((resolve)=>{wx.config({debug:false,appId:vqll.appId,timestamp:vqll.timestamp,nonceStr:vqll.nonceStr,signature:vqll.signature,jsApiList:[ 'updateAppMessageShareData','updateTimelineShareData','onMenuShareAppMessage','onMenuShareTimeline' ]});wx.ready(()=>{this.mk0z();resolve();});wx.error((res)=>{console.error('微信SDK初始化失败:',res);});});}async mtm5(){let vNml = await fetch('/api/wechat-vqll',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({url:window.location.href.split('#')[0]})});if(!vNml.ok){throw new Error('获取微信配置失败');}return await vNml.json();}mk0z(){let vtGn ={title:'这个测试太有意思了，你也来试试吧',desc:'我发现了一个超准的心理测试，快来测测你的性格！',link:window.location.href,imgUrl:'https:};wx.updateAppMessageShareData(vtGn);wx.onMenuShareAppMessage(vtGn);wx.updateTimelineShareData({title:vtGn.title,link:vtGn.link,imgUrl:vtGn.imgUrl});wx.onMenuShareTimeline({title:vtGn.title,link:vtGn.link,imgUrl:vtGn.imgUrl});}my4q(){let vrA0 = document.createElement('div');vrA0.className = 'share-tip';vrA0.innerHTML = ` <div class="share-bubble"> <div class="share-arrow"></div> <div class="share-content"> 分享给好友立减1元 <button class="share-confirm-btn">立即分享</button> </div> </div> `;let vuym = document.createElement('vuym');vuym.textContent = ` .share-tip{position:fixed;top:60px;right:15px;z-index:1000;}.share-bubble{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);position:relative;max-width:200px;}.share-arrow{position:absolute;top:-8px;right:20px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid #667eea;}.share-confirm-btn{background:white;color:#667eea;border:none;padding:6px 12px;border-radius:4px;margin-top:8px;font-size:12px;cursor:pointer;width:100%;}`;document.head.appendChild(vuym);document.body.appendChild(vrA0);vrA0.querySelector('.share-confirm-btn').addEventListener('click',()=>{this.mWwt();vrA0.remove();});setTimeout(()=>{if(vrA0.parentNode){vrA0.remove();}},3000);}mWwt(){if(this.isWechat){this.ma00('wechat_share_click');}else{this.myDm();}}myDm(){let vg4s = '请点击浏览器菜单中的分享按钮，分享给好友';if(window.app && window.app.showToast){window.app.showToast(vg4s);}else{alert(vg4s);}}ma00(eventType){fetch('/api/track-share',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({eventType:eventType,testId:new URLSearchParams(window.location.search).get('id'),userId:storageManager.getUserInfo().userId,timestamp:Date.now()})}).catch(console.error);}async mo1M(){try{let vNml = await fetch('/api/verify-share',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({testId:new URLSearchParams(window.location.search).get('id'),userId:storageManager.getUserInfo().userId})});if(vNml.ok){let vpk3 = await vNml.json();if(vpk3.shared){this.mpYb('分享成功！');return true;}}}mm4d(error){console.error('验证分享失败:',error);}return false;}mpYb(message){if(window.app && window.app.showToast){window.app.showToast(message);}}}window.shareManager = new ShareManager();