<!DOCTYPE html>
<html>
<head>
    <title>å®Œæ•´æ··æ·†æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { 
            margin: 10px 0; 
            padding: 10px; 
            background: #f5f5f5; 
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .test-item { 
            margin: 8px 0; 
            padding: 8px; 
            border-left: 3px solid #ddd;
            background: white;
        }
        #status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 5px;
            font-weight: bold;
        }
        #codePreview {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 400px;
            overflow: auto;
            white-space: pre-wrap;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .button-row {
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>å®Œæ•´æ··æ·†æµ‹è¯•</h1>
    
    <div class="info">
        <strong>ğŸ“Š æ··æ·†ä¿¡æ¯</strong><br>
        åŸå§‹æ–‡ä»¶: 54KB<br>
        æ··æ·†å: 33KB<br>
        å‹ç¼©ç‡: 39.1%<br>
        éªŒè¯çŠ¶æ€: âœ… é€šè¿‡
    </div>
    
    <div class="button-row">
        <button onclick="runBasicTests()">è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
        <button onclick="runAdvancedTests()">è¿è¡Œé«˜çº§æµ‹è¯•</button>
        <button onclick="showCodePreview()">æ˜¾ç¤ºä»£ç é¢„è§ˆ</button>
    </div>
    
    <div id="status">ç­‰å¾…æµ‹è¯•...</div>
    <div id="testResults"></div>
    <div id="codePreview" style="display: none;"></div>
    
    <script src="js-dist/calculation.complete.js"></script>
    <script>
        let testResults = [];
        
        function addTestResult(name, passed, message = '') {
            testResults.push({ name, passed, message });
            return passed;
        }
        
        function runBasicTests() {
            testResults = [];
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('testResults');
            
            statusEl.innerHTML = 'ğŸ” è¿è¡ŒåŸºç¡€æµ‹è¯•...';
            statusEl.style.background = '#fff3cd';
            statusEl.style.color = '#856404';
            
            try {
                // æµ‹è¯•1: å…¨å±€å¯¹è±¡
                const hasCalculationManager = typeof calculationManager !== 'undefined';
                addTestResult('CalculationManagerå…¨å±€å¯¹è±¡', hasCalculationManager, 
                    hasCalculationManager ? 'å­˜åœ¨' : 'æœªå®šä¹‰');
                
                if (!hasCalculationManager) {
                    updateResults();
                    return;
                }
                
                // æµ‹è¯•2: æ ¸å¿ƒå‡½æ•°å­˜åœ¨æ€§
                const coreFunctions = [
                    'calculateResult',
                    'calculateSCL90',
                    'calculateAnimalPersonality',
                    'calculateSpiritualNeeds',
                    'calculateWeatherPersonalityV2',
                    'calculateHollandAdapt',
                    'calculateRelationshipComfort',
                    'calculateMingDynasty',
                    'calculateCareerCompass'
                ];
                
                coreFunctions.forEach(funcName => {
                    const func = calculationManager[funcName];
                    const isFunction = typeof func === 'function';
                    addTestResult(`${funcName}å‡½æ•°`, isFunction, 
                        isFunction ? 'å¯ç”¨' : 'ä¸å¯ç”¨');
                });
                
                // æµ‹è¯•3: ç®€å•åŠŸèƒ½æµ‹è¯•
                try {
                    // æµ‹è¯•åŠ¨ç‰©äººæ ¼è®¡ç®—ï¼ˆä¸éœ€è¦å¤–éƒ¨æ•°æ®ï¼‰
                    const animalResult = calculationManager.calculateAnimalPersonality(['A', 'B', 'C', 'D']);
                    addTestResult('calculateAnimalPersonalityæ‰§è¡Œ', true, 
                        `æˆåŠŸè¿”å›: ${animalResult.animal || 'æœªçŸ¥åŠ¨ç‰©'}`);
                } catch (e) {
                    addTestResult('calculateAnimalPersonalityæ‰§è¡Œ', false, 
                        `é”™è¯¯: ${e.message}`);
                }
                
            } catch (error) {
                addTestResult('æµ‹è¯•æ¡†æ¶', false, `æ¡†æ¶é”™è¯¯: ${error.message}`);
            }
            
            updateResults();
        }
        
        function runAdvancedTests() {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = 'ğŸ§ª è¿è¡Œé«˜çº§æµ‹è¯•...';
            statusEl.style.background = '#d1ecf1';
            statusEl.style.color = '#0c5460';
            
            try {
                // æµ‹è¯•SCL90è®¡ç®—ï¼ˆéœ€è¦æµ‹è¯•æ•°æ®ï¼‰
                const testData = {
                    dimensions: {
                        anxiety: {
                            name: 'ç„¦è™‘',
                            items: [1, 2, 3],
                            highDescription: 'é«˜ç„¦è™‘æè¿°',
                            lowDescription: 'ä½ç„¦è™‘æè¿°',
                            interpretation: 'è§£é‡Šæ–‡æœ¬',
                            scoreRange: [0, 4],
                            threshold: 2.0
                        }
                    },
                    questions: [
                        {
                            options: [
                                { id: 'A', score: 1 },
                                { id: 'B', score: 2 }
                            ]
                        },
                        {
                            options: [
                                { id: 'A', score: 1 },
                                { id: 'B', score: 2 }
                            ]
                        },
                        {
                            options: [
                                { id: 'A', score: 1 },
                                { id: 'B', score: 2 }
                            ]
                        }
                    ]
                };
                
                const answers = ['A', 'B', 'A'];
                const sclResult = calculationManager.calculateSCL90(answers, testData);
                
                addTestResult('calculateSCL90å®Œæ•´æµ‹è¯•', true, 
                    `æˆåŠŸ: testType=${sclResult.testType}, score=${sclResult.score}`);
                
                // æµ‹è¯•æ•°æ®ç»“æ„
                const requiredProps = ['score', 'totalScore', 'testType', 'dimensions', 'positiveItems'];
                let structTestPassed = true;
                let structMessage = '';
                
                requiredProps.forEach(prop => {
                    if (!(prop in sclResult)) {
                        structTestPassed = false;
                        structMessage += `${prop}ç¼ºå¤± `;
                    }
                });
                
                addTestResult('SCL90æ•°æ®ç»“æ„', structTestPassed,
                    structTestPassed ? 'å®Œæ•´' : `ä¸å®Œæ•´: ${structMessage}`);
                
            } catch (error) {
                addTestResult('é«˜çº§æµ‹è¯•', false, `é”™è¯¯: ${error.message}`);
            }
            
            updateResults();
        }
        
        function updateResults() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('testResults');
            
            let allPassed = true;
            let html = '<h3>æµ‹è¯•ç»“æœ:</h3>';
            
            testResults.forEach(result => {
                allPassed = allPassed && result.passed;
                const color = result.passed ? 'green' : 'red';
                html += `
                <div class="test-item" style="border-color: ${color}">
                    ${result.passed ? 'âœ…' : 'âŒ'} 
                    <strong>${result.name}</strong>
                    ${result.message ? '<br><span style="font-size: 0.9em; color: #666;">' + result.message + '</span>' : ''}
                </div>`;
            });
            
            resultsEl.innerHTML = html;
            
            if (allPassed) {
                statusEl.innerHTML = 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ··æ·†æˆåŠŸï¼';
                statusEl.style.background = '#d4edda';
                statusEl.style.color = '#155724';
            } else {
                statusEl.innerHTML = 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
            }
        }
        
        function showCodePreview() {
            const previewEl = document.getElementById('codePreview');
            previewEl.style.display = 'block';
            
            // è·å–ä»£ç å‰1000å­—ç¬¦
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'js-dist/calculation.complete.js', true);
            xhr.onload = function() {
                if (xhr.status === 200) {
                    const code = xhr.responseText;
                    previewEl.innerHTML = `
                    <strong>æ··æ·†ä»£ç é¢„è§ˆï¼ˆå‰1000å­—ç¬¦ï¼‰:</strong>
                    <pre>${code.substring(0, 1000)}...</pre>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        ğŸ” æ£€æŸ¥è¦ç‚¹: questionå˜é‡ã€dimensionKeyså¸¸é‡ã€å‡½æ•°è°ƒç”¨
                    </div>`;
                }
            };
            xhr.send();
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        setTimeout(runBasicTests, 500);
    </script>
</body>
</html>