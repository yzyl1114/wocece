<!DOCTYPE html>
<html>
<head>
    <title>ä¿æŠ¤å±æ€§æ··æ·†æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        #testResults { margin-top: 20px; }
        .test-item { margin: 5px 0; padding: 5px; border-left: 3px solid #ddd; }
    </style>
</head>
<body>
    <h1>ä¿æŠ¤å¯¹è±¡å±æ€§æ··æ·†æµ‹è¯•</h1>
    <div class="info">
        <strong>æ–‡ä»¶ä¿¡æ¯:</strong><br>
        åŸå§‹æ–‡ä»¶: 54KB<br>
        æ··æ·†å: 30KB<br>
        å‹ç¼©ç‡: 44.2%
    </div>
    
    <div id="status">åŠ è½½JavaScript...</div>
    <div id="testResults"></div>
    
    <script src="js-dist/calculation.protected.js"></script>
    <script>
        function runTests() {
            const results = [];
            const testResultsEl = document.getElementById('testResults');
            
            // æµ‹è¯•1: CalculationManageræ˜¯å¦å­˜åœ¨
            try {
                if (typeof calculationManager === 'undefined') {
                    results.push({ name: 'CalculationManagerå­˜åœ¨', passed: false, message: 'æœªå®šä¹‰' });
                    return results;
                }
                results.push({ name: 'CalculationManagerå­˜åœ¨', passed: true });
                
                // æµ‹è¯•2: æ ¸å¿ƒå‡½æ•°
                const coreFunctions = [
                    'calculateResult',
                    'calculateSCL90', 
                    'calculateAnimalPersonality',
                    'calculateSpiritualNeeds',
                    'calculateWeatherPersonalityV2'
                ];
                
                coreFunctions.forEach(funcName => {
                    const passed = typeof calculationManager[funcName] === 'function';
                    results.push({ 
                        name: `${funcName}å‡½æ•°`, 
                        passed,
                        message: passed ? 'å¯ç”¨' : 'ä¸å¯ç”¨'
                    });
                });
                
                // æµ‹è¯•3: åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•æ•°æ®
                const testData = {
                    dimensions: {
                        anxiety: { name: 'ç„¦è™‘', items: [1, 2, 3] }
                    },
                    questions: [
                        { options: [{ id: 'A', score: 1 }, { id: 'B', score: 2 }] },
                        { options: [{ id: 'A', score: 1 }, { id: 'B', score: 2 }] },
                        { options: [{ id: 'A', score: 1 }, { id: 'B', score: 2 }] }
                    ]
                };
                
                // æµ‹è¯•4: å°è¯•è°ƒç”¨calculateSCL90
                try {
                    const testResult = calculationManager.calculateSCL90(['A', 'B', 'A'], testData);
                    results.push({ 
                        name: 'calculateSCL90æ‰§è¡Œ', 
                        passed: true,
                        message: 'æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›: ' + (testResult.testType || 'æœªçŸ¥')
                    });
                } catch (e) {
                    results.push({ 
                        name: 'calculateSCL90æ‰§è¡Œ', 
                        passed: false,
                        message: 'æ‰§è¡Œé”™è¯¯: ' + e.message
                    });
                }
                
            } catch (error) {
                results.push({ 
                    name: 'æ•´ä½“æµ‹è¯•', 
                    passed: false, 
                    message: 'æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: ' + error.message 
                });
            }
            
            return results;
        }
        
        // æ‰§è¡Œæµ‹è¯•
        setTimeout(() => {
            const statusEl = document.getElementById('status');
            const testResults = runTests();
            
            let allPassed = true;
            let html = '<h3>æµ‹è¯•ç»“æœ:</h3>';
            
            testResults.forEach(result => {
                allPassed = allPassed && result.passed;
                html += `<div class="test-item" style="border-color: ${result.passed ? 'green' : 'red'}">
                    ${result.passed ? 'âœ…' : 'âŒ'} ${result.name}
                    ${result.message ? ' - ' + result.message : ''}
                </div>`;
            });
            
            document.getElementById('testResults').innerHTML = html;
            
            if (allPassed) {
                statusEl.innerHTML = '<span class="success">âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ä»£ç åŠŸèƒ½æ­£å¸¸ã€‚</span>';
                console.log('ğŸ‰ æ··æ·†æµ‹è¯•å®Œæˆï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼');
            } else {
                statusEl.innerHTML = '<span class="error">âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ã€‚</span>';
            }
        }, 100);
    </script>
</body>
</html>