<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ‹è¯•è¯¦æƒ… - æˆ‘æµ‹æµ‹</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="page-container">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo" id="backButton">â† è¿”å›</div>
            </div>
        </nav>
        
        <!-- æµ‹è¯•å°é¢ -->
        <div class="test-cover">
            <img id="testCoverImage" src="" alt="æµ‹è¯•å°é¢" class="cover-image">
            <h1 id="testTitle" class="test-title-main"></h1>
        </div>    

        <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ - æ ‡å‡†æµ‹è¯•ç‰¹æœ‰ -->
        <section class="basic-info-section standard-only" id="basicInfoSection" style="display: none;">
            <div class="basic-info-cards" id="basicInfoCards">
                <!-- åŠ¨æ€ç”Ÿæˆï¼šé¢˜ç›®æ•°é‡ã€æµ‹è¯•æ—¶é•¿ã€æŠ¥å‘Šç±»å‹ -->
            </div>
        </section>

        <!-- æµ‹è¯•æè¿° - è¶£å‘³æµ‹è¯•ä½¿ç”¨ -->
        <section class="test-description fun-only" id="funDescriptionSection" style="display: none;">
            <div class="description-content">
                <p id="testDescription"></p>
            </div>
        </section>

        <!-- ç†è®ºä¾æ® - æ ‡å‡†æµ‹è¯•ä½¿ç”¨ -->
        <section class="theory-section standard-only" id="theorySection" style="display: none;">
            <h3>ç†è®ºä¾æ®</h3>
            <div class="theory-content" id="theoryContent">
                <!-- å†…å®¹å’Œå›¾ç‰‡ -->
            </div>
        </section>

        <!-- æµ‹è¯•è¦æ±‚ - æ ‡å‡†æµ‹è¯•ä½¿ç”¨ -->
        <section class="requirements-section standard-only" id="requirementsSection" style="display: none;">
            <h3>æµ‹è¯•è¦æ±‚</h3>
            <div class="requirements-content" id="requirementsContent">
                <!-- å†…å®¹å’Œå›¾ç‰‡ -->
            </div>
        </section>

        <!-- æŠ¥å‘Šç¤ºä¾‹ - æ ‡å‡†æµ‹è¯•ä½¿ç”¨ -->
        <section class="report-example-section standard-only" id="reportExampleSection" style="display: none;">
            <h3>æŠ¥å‘Šå†…å®¹</h3>
            <div class="report-example-content" id="reportExampleContent">
                <!-- å†…å®¹å’Œå›¾ç‰‡ -->
            </div>
        </section>

        <!-- ç«‹å³æµ‹è¯•æŒ‰é’® -->
        <section class="action-section">
            <button id="startTestBtn" class="primary-btn">
                Â¥<span id="testPrice">1</span> è§£é”æµ‹è¯•
            </button>
            <div class="redeem-link">
                <a href="#" id="redeemLink">å·²æœ‰å…‘æ¢ç /ä¼˜æƒ ç ï¼Ÿç‚¹å‡»è¿™é‡Œ</a>
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer class="page-footer">
            *æµ‹è¯•ä»…ä¾›å¨±ä¹*
        </footer>
    </div>

    <!-- Toastæç¤º -->
    <div class="toast"></div>

    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/payment.js"></script>
    <script>
        // å¤„ç†çªå‡ºæ˜¾ç¤ºæ–‡æœ¬çš„å‡½æ•°
        function processHighlightText(text) {
            if (!text) return '';
            
            // ä½¿ç”¨ **å†…å®¹** ä½œä¸ºçªå‡ºæ˜¾ç¤ºæ ‡è®°
            return text.replace(/\*\*(.*?)\*\*/g, '<span class="highlight-text">$1</span>');
        }
        class DetailManager {
            constructor() {
                this.testId = null;
                this.testData = null;
                this.templateType = 'fun'; // é»˜è®¤è¶£å‘³æ¨¡æ¿
                this.init();
            }

            async init() {
                this.testId = new URLSearchParams(window.location.search).get('id');
                await this.loadTestData();
                this.determineTemplateType();
                this.renderTestDetail();
                this.bindEvents();
                this.checkPaymentReturn(); // æ£€æŸ¥æ˜¯å¦ä»æ”¯ä»˜è¿”å›
                this.checkRedeemSuccess(); // æ–°å¢ï¼šæ£€æŸ¥å…‘æ¢æˆåŠŸçŠ¶æ€
            }

            // æ–°å¢ï¼šæ£€æŸ¥å…‘æ¢æˆåŠŸçŠ¶æ€
            checkRedeemSuccess() {
                const urlParams = new URLSearchParams(window.location.search);
                const redeemSuccess = urlParams.get('redeem_success');
                
                if (redeemSuccess === 'true') {
                    this.showToast('å…‘æ¢æˆåŠŸï¼å·²è§£é”æµ‹è¯•');
                    
                    // æ ‡è®°ä¸ºå·²å…‘æ¢ï¼ˆä½†ä¸æ ‡è®°ä¸ºå·²å®Œæˆï¼‰
                    // æ³¨æ„ï¼šè¿™é‡Œåªä¿å­˜å…‘æ¢è®°å½•ï¼Œä¸ä¿å­˜æ”¯ä»˜è®°å½•
                    const redeemRecords = JSON.parse(localStorage.getItem('redeem_records') || '{}');
                    redeemRecords[this.testId] = {
                        redeemed: true,
                        timestamp: Date.now()
                    };
                    localStorage.setItem('redeem_records', JSON.stringify(redeemRecords));
                    
                    // æ¸…é™¤URLå‚æ•°ï¼Œé¿å…é‡å¤æç¤º
                    const newUrl = window.location.pathname + '?id=' + this.testId;
                    window.history.replaceState({}, '', newUrl);
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    this.updateButtonState();
                }
            }

            async loadTestData() {
                try {
                    this.testId = new URLSearchParams(window.location.search).get('id');
                    
                    const response = await fetch('/api/get-tests.php?id=' + this.testId);
                    const result = await response.json();
                    
                    if (result.code === 0) {
                        // result.data ç›´æ¥å°±æ˜¯æµ‹è¯•å¯¹è±¡
                        this.testData = result.data;
                    } else {
                        throw new Error('æµ‹è¯•æ•°æ®ä¸å­˜åœ¨: ' + result.msg);
                    }
                    
                    if (!this.testData) {
                        throw new Error('æµ‹è¯•æ•°æ®ä¸å­˜åœ¨');
                    }
                    
                } catch (error) {
                    console.error('åŠ è½½æµ‹è¯•æ•°æ®å¤±è´¥:', error);
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    this.testData = {
                        id: this.testId,
                        title: 'å¿ƒç†æµ‹è¯•',
                        description: 'è¿™æ˜¯ä¸€ä¸ªåŸºäºå¿ƒç†å­¦åŸç†çš„æµ‹è¯•...',
                        templateType: 'fun',
                        price: 1,
                        image: 'images/test-detail.jpg'
                    };
                }
            }

            determineTemplateType() {
                this.templateType = this.testData.templateType || 'fun';
            }

            renderTestDetail() {
                // åŸºç¡€ä¿¡æ¯
                document.getElementById('testCoverImage').src = this.testData.image;
                document.getElementById('testTitle').textContent = this.testData.title;
                document.getElementById('testPrice').textContent = this.testData.price;
                
                // æ ¹æ®æ¨¡æ¿ç±»å‹æ˜¾ç¤ºä¸åŒå†…å®¹
                if (this.templateType === 'standard') {
                    this.renderStandardTemplate();
                } else {
                    this.renderFunTemplate();
                }
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                document.title = `${this.testData.title} - æˆ‘æµ‹æµ‹`;

                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                this.updateButtonState();

                setTimeout(() => {
                    document.body.classList.add('content-loaded');
                }, 100);
            }

            renderStandardTemplate() {
                // éšè—è¶£å‘³æµ‹è¯•éƒ¨åˆ†ï¼Œæ˜¾ç¤ºæ ‡å‡†æµ‹è¯•éƒ¨åˆ†
                document.querySelectorAll('.fun-only').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.standard-only').forEach(el => el.style.display = 'block');

                // æ¸²æŸ“åŸºæœ¬ä¿¡æ¯å¡ç‰‡
                this.renderBasicInfoCards();
                
                // æ¸²æŸ“ç†è®ºä¾æ®
                this.renderTheorySection();
                
                // æ¸²æŸ“æµ‹è¯•è¦æ±‚  
                this.renderRequirementsSection();
                
                // æ¸²æŸ“æŠ¥å‘Šç¤ºä¾‹
                this.renderReportExampleSection();
            }

            renderFunTemplate() {
                // éšè—æ ‡å‡†æµ‹è¯•éƒ¨åˆ†ï¼Œæ˜¾ç¤ºè¶£å‘³æµ‹è¯•éƒ¨åˆ†
                document.querySelectorAll('.standard-only').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.fun-only').forEach(el => el.style.display = 'block');
                
                // æ¸²æŸ“æè¿°
                document.getElementById('testDescription').textContent = this.testData.description;
            }

            renderBasicInfoCards() {
                if (!this.testData.basicInfo) return;
                
                const container = document.getElementById('basicInfoCards');
                const info = this.testData.basicInfo;
                
                container.innerHTML = `
                    <div class="info-card">
                        <div class="info-number">${info.questions}</div>
                        <div class="info-label">é“é¢˜</div>
                    </div>
                    <div class="info-card">
                        <div class="info-number">${info.duration}</div>
                        <div class="info-label">åˆ†é’Ÿ</div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">ğŸ“Š</div>
                        <div class="info-label">${info.reportType}</div>
                    </div>
                `;
            }

            renderTheorySection() {
                if (!this.testData.theory) return;
                
                const container = document.getElementById('theoryContent');
                const theory = this.testData.theory;
                
                // ğŸ”§ ä¿®å¤ï¼šå…ˆå¤„ç†æ¢è¡Œï¼Œå†å¤„ç†é«˜äº®æ ‡è®°
                const processedContent = processHighlightText(theory.content);
                const paragraphs = processedContent.split('\n').filter(p => p.trim());
                
                let contentHTML = `
                    <div class="text-content">
                        ${paragraphs.map(p => `<p>${p}</p>`).join('')}
                    </div>
                `;
                // å¦‚æœæœ‰å›¾ç‰‡ï¼Œæ·»åŠ å›¾ç‰‡
                if (theory.image) {
                    contentHTML += `
                        <div class="image-content">
                            <img src="${theory.image}" alt="ç†è®ºä¾æ®ç¤ºæ„å›¾" class="content-image">
                        </div>
                    `;
                }
                
                container.innerHTML = contentHTML;
            }

            renderRequirementsSection() {
                if (!this.testData.requirements) return;
                
                const container = document.getElementById('requirementsContent');
                const requirements = this.testData.requirements;
                
                let contentHTML = `
                    <div class="text-content">
                        <p>${processHighlightText(requirements.content)}</p>
                        <ul class="requirements-list">
                            ${requirements.items.map(item => `<li>${processHighlightText(item)}</li>`).join('')}
                        </ul>
                    </div>
                `;
                
                // å¦‚æœæœ‰å›¾ç‰‡ï¼Œæ·»åŠ å›¾ç‰‡
                if (requirements.image) {
                    contentHTML += `
                        <div class="image-content">
                            <img src="${requirements.image}" alt="æµ‹è¯•è¦æ±‚ç¤ºæ„å›¾" class="content-image">
                        </div>
                    `;
                }
                
                container.innerHTML = contentHTML;
            }

            renderReportExampleSection() {
                if (!this.testData.reportExample) return;
                
                const container = document.getElementById('reportExampleContent');
                const example = this.testData.reportExample;
                
                let contentHTML = `
                    <div class="text-content">
                        <div class="report-steps">
                            ${example.steps.map(step => `
                                <div class="report-step">
                                    <div class="step-header">
                                        <span class="step-title">${step.title}</span>
                                        <span class="step-subtitle">${step.subtitle}</span>
                                    </div>
                                    <div class="step-description">${processHighlightText(step.description)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                // å¦‚æœæœ‰å›¾ç‰‡ï¼Œæ·»åŠ å›¾ç‰‡
                if (example.image) {
                    contentHTML += `
                        <div class="image-content">
                            <img src="${example.image}" alt="æŠ¥å‘Šç¤ºä¾‹ç¤ºæ„å›¾" class="content-image">
                        </div>
                    `;
                }
                
                container.innerHTML = contentHTML;
            }

            bindEvents() {
                // ä¿®å¤ï¼šæ˜ç¡®çš„è¿”å›æŒ‰é’®äº‹ä»¶ç»‘å®š
                const backButton = document.getElementById('backButton');
                if (backButton) {
                    backButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('è¯¦æƒ…é¡µè¿”å›æŒ‰é’®ç‚¹å‡»ï¼Œè·³è½¬åˆ°é¦–é¡µ');
                        window.location.href = 'index.html';
                    });
                }
                
                // ç«‹å³æµ‹è¯•æŒ‰é’®
                document.getElementById('startTestBtn').addEventListener('click', () => {
                    this.handleStartTest();
                });

                // å…‘æ¢ç é“¾æ¥
                document.getElementById('redeemLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.goToRedeem();
                });
            }

            // æ£€æŸ¥æ”¯ä»˜è¿”å›çŠ¶æ€
            checkPaymentReturn() {
                const urlParams = new URLSearchParams(window.location.search);
                const paymentSuccess = urlParams.get('payment_success');
                const paymentTestId = urlParams.get('testId');
                
                // å¦‚æœæ˜¯ä»æ”¯ä»˜æˆåŠŸé¡µé¢è¿”å›ï¼Œå¹¶ä¸”æµ‹è¯•IDåŒ¹é…
                if (paymentSuccess === 'true' && paymentTestId === this.testId) {
                    this.showToast('æ”¯ä»˜æˆåŠŸï¼å·²è§£é”æµ‹è¯•');
                    
                    // æ ‡è®°ä¸ºå·²æ”¯ä»˜
                    storageManager.savePaymentRecord(this.testId);
                    
                    // æ¸…é™¤URLå‚æ•°ï¼Œé¿å…é‡å¤æç¤º
                    const newUrl = window.location.pathname + '?id=' + this.testId;
                    window.history.replaceState({}, '', newUrl);
                }
            }

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonState() {
                const startBtn = document.getElementById('startTestBtn');
                const priceSpan = document.getElementById('testPrice');
                
                // æ£€æŸ¥æ˜¯å¦å·²æ”¯ä»˜/å·²å…‘æ¢ä¸”æœªå®Œæˆ
                const hasPaid = storageManager.hasPaidForTest(this.testId);
                const hasRedeemed = this.hasRedeemedForTest(this.testId);
                const hasCompleted = this.hasCompletedTest(this.testId);
                
                console.log('æŒ‰é’®çŠ¶æ€æ£€æŸ¥:', {
                    hasPaid, 
                    hasRedeemed, 
                    hasCompleted
                });
                
                if ((hasPaid || hasRedeemed) && !hasCompleted) {
                    // å·²æ”¯ä»˜/å…‘æ¢ä½†æœªå®Œæˆï¼Œæ˜¾ç¤ºç«‹å³æµ‹è¯•
                    startBtn.innerHTML = `ç«‹å³æµ‹è¯•`;
                    if (priceSpan) priceSpan.style.display = 'none';
                } else {
                    // æœªæ”¯ä»˜/å…‘æ¢ æˆ– å·²å®Œæˆï¼Œæ˜¾ç¤ºè§£é”æµ‹è¯•
                    startBtn.innerHTML = `Â¥<span id="testPrice">${this.testData.price}</span> è§£é”æµ‹è¯•`;
                    if (priceSpan) priceSpan.style.display = 'inline';
                }
            }

            // æ–°å¢æ–¹æ³•ï¼šæ£€æŸ¥æ˜¯å¦å·²å®Œæˆæµ‹è¯•
            hasCompletedTest(testId) {
                // æ£€æŸ¥æ˜¯å¦æœ‰æµ‹è¯•ç»“æœ
                const results = this.getAllTestResults();
                return results.some(result => result.testId === testId);
            }

            // æ–°å¢æ–¹æ³•ï¼šè·å–æ‰€æœ‰æµ‹è¯•ç»“æœ
            getAllTestResults() {
                const results = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('test_result_')) {
                        try {
                            const result = JSON.parse(localStorage.getItem(key));
                            if (result && result.data) {
                                results.push({
                                    testId: result.data.testId || 'unknown',
                                    timestamp: result.timestamp,
                                    resultId: key.replace('test_result_', '')
                                });
                            }
                        } catch (e) {
                            console.error('è§£ææµ‹è¯•ç»“æœå¤±è´¥:', e);
                        }
                    }
                }
                return results;
            }            

            handleStartTest() {
                // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆæµ‹è¯•
                const hasCompleted = this.hasCompletedTest(this.testId);
                
                if (hasCompleted) {
                    console.log('æµ‹è¯•å·²å®Œæˆï¼Œéœ€è¦é‡æ–°è§£é”:', this.testId);
                    this.showToast('å·²å®Œæˆæµ‹è¯•ï¼Œéœ€è¦é‡æ–°è§£é”');
                    
                    // å…³é”®ä¿®å¤ï¼šæ¸…é™¤çŠ¶æ€åç«‹å³è§¦å‘æ”¯ä»˜æµç¨‹
                    storageManager.clearCompletionStatus(this.testId);
                    storageManager.clearPaymentRecord(this.testId);
                    this.clearRedeemRecord(this.testId);
                    
                    // é‡æ–°æ£€æŸ¥çŠ¶æ€
                    this.updateButtonState();
                    
                    // æ–°å¢ï¼šç›´æ¥å¯åŠ¨æ”¯ä»˜æµç¨‹
                    setTimeout(() => {
                        if (window.paymentManager) {
                            window.paymentManager.initializePayment(this.testId, this.testData.price);
                        } else {
                            // å¤‡ç”¨æ–¹æ¡ˆï¼šè·³è½¬åˆ°æµ‹è¯•é¡µé¢
                            window.location.href = `testing.html?id=${this.testId}`;
                        }
                    }, 1500); // ç»™ç”¨æˆ·1.5ç§’çœ‹åˆ°æç¤º
                    
                    return;
                }
                
                // æ­£å¸¸æµç¨‹ï¼šæ£€æŸ¥æ˜¯å¦å·²æ”¯ä»˜ã€å·²å…‘æ¢æˆ–æœ‰è¿›åº¦
                const hasPaid = storageManager.hasPaidForTest(this.testId);
                const hasRedeemed = this.hasRedeemedForTest(this.testId);
                const hasProgress = storageManager.getTestProgress(this.testId);
                
                console.log('å¼€å§‹æµ‹è¯•æ£€æŸ¥:', {
                    testId: this.testId,
                    hasPaid,
                    hasRedeemed, 
                    hasProgress,
                    hasCompleted
                });
                
                if (this.testData.price === 0 || hasPaid || hasRedeemed || hasProgress) {
                    window.location.href = `testing.html?id=${this.testId}`;
                } else {
                    // éœ€è¦æ”¯ä»˜
                    if (window.paymentManager) {
                        window.paymentManager.initializePayment(this.testId, this.testData.price);
                    } else {
                        this.showToast('æ­£åœ¨å‡†å¤‡æ”¯ä»˜...');
                        setTimeout(() => {
                            window.location.href = `testing.html?id=${this.testId}`;
                        }, 1000);
                    }
                }
            }

            hasRedeemedForTest(testId) {
                const redeemRecords = JSON.parse(localStorage.getItem('redeem_records') || '{}');
                const record = redeemRecords[testId];
                
                if (record && record.redeemed) {
                    // æ£€æŸ¥å…‘æ¢ç æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼ˆå¯é€‰ï¼‰
                    const usedAt = new Date(record.usedAt);
                    const now = new Date();
                    const hoursDiff = (now - usedAt) / (1000 * 60 * 60);
                    
                    // å¦‚æœå…‘æ¢è¶…è¿‡7å¤©è§†ä¸ºè¿‡æœŸ
                    if (hoursDiff > 168) {
                        console.log('å…‘æ¢è®°å½•å·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°å…‘æ¢:', testId);
                        delete redeemRecords[testId]; // æ¸…é™¤è¿‡æœŸè®°å½•
                        localStorage.setItem('redeem_records', JSON.stringify(redeemRecords));
                        return false;
                    }
                    
                    // å¦‚æœå·²å…‘æ¢ä½†å·²å®Œæˆæµ‹è¯•ï¼Œåˆ™è§†ä¸ºæœªå…‘æ¢
                    if (this.hasCompletedTest(testId)) {
                        console.log('å·²å…‘æ¢ä½†å·²å®Œæˆæµ‹è¯•ï¼Œéœ€è¦é‡æ–°å…‘æ¢:', testId);
                        return false;
                    }
                    return true;
                }
                return false;
            }

            // æ–°å¢ï¼šæ¸…é™¤å…‘æ¢è®°å½•çš„æ–¹æ³•
            clearRedeemRecord(testId) {
                const redeemRecords = JSON.parse(localStorage.getItem('redeem_records') || '{}');
                if (redeemRecords[testId]) {
                    delete redeemRecords[testId];
                    localStorage.setItem('redeem_records', JSON.stringify(redeemRecords));
                    console.log('å…‘æ¢è®°å½•å·²æ¸…é™¤:', testId);
                }
            }            

            goToRedeem() {
                window.location.href = `redeem.html?testId=${this.testId}`;
            }

            showToast(message) {
                const toast = document.querySelector('.toast');
                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }
        }

        // åˆå§‹åŒ–è¯¦æƒ…é¡µ
        document.addEventListener('DOMContentLoaded', () => {
            window.detailManager = new DetailManager();
        });
    </script>

    <style>
        /* é‡ç½®æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #F8FDFB 0%, #F0F9F7 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            min-height: 100vh;
        }

        /* é¡µé¢ä¸»å®¹å™¨ */
        .page-container {
            width: 100%;
            min-height: 100vh;
            background: white;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            width: 100%;
            display: flex;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #00B894, #00CEC9);
            min-height: 60px;
        }

        .nav-container {
            width: 100%;
            max-width: 750px;
            margin: 0 auto;
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            padding: 8px 0;
        }

        /* æµ‹è¯•å°é¢ */
        .test-cover {
            position: relative;
            width: 100%;
            height: 250px;
            overflow: hidden;
        }

        .cover-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .test-title-main {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 60px 20px 20px 20px;
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        /* å†…å®¹åŒºåŸŸé€šç”¨æ ·å¼ */
        .basic-info-section,
        .test-description,
        .theory-section,
        .requirements-section,
        .report-example-section,
        .action-section {
            width: 100%;
            max-width: 750px;
            margin: 0 auto 15px auto;
            padding: 20px;
            background: white;
        }

        /* åŸºæœ¬ä¿¡æ¯å¡ç‰‡ */
        .basic-info-section {
            padding: 20px;
        }

        .basic-info-cards {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .info-card {
            flex: 1;
            padding: 15px 5px;
        }

        .info-number {
            font-size: 24px;
            font-weight: bold;
            color: #00B894;
            margin-bottom: 5px;
        }

        .info-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .info-label {
            font-size: 14px;
            color: #666;
        }

        /* æ ‡å‡†æµ‹è¯•å†…å®¹åŒºåŸŸ */
        .theory-section,
        .requirements-section,
        .report-example-section {
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .theory-section h3,
        .requirements-section h3,
        .report-example-section h3 {
            color: #333;
            margin-bottom: 15px;
            border-left: 4px solid #00B894;
            padding-left: 10px;
            font-size: 18px;
        }

        .text-content {
            line-height: 1.8;
            color: #666;
            margin-bottom: 15px;
        }

        .text-content p {
            margin-bottom: 10px;
        }

        .requirements-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }

        .requirements-list li {
            padding: 8px 0;
            position: relative;
            padding-left: 15px;
        }

        .requirements-list li:before {
            content: "â€¢";
            color: #00B894;
            position: absolute;
            left: 0;
        }

        .image-content {
            text-align: center;
            margin-top: 15px;
        }

        .content-image {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* æŠ¥å‘Šæ­¥éª¤ */
        .report-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .report-step {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .step-header {
            display: flex;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .step-title {
            font-weight: bold;
            color: #00B894;
            margin-right: 10px;
            font-size: 16px;
        }

        .step-subtitle {
            font-weight: bold;
            color: #333;
            font-size: 15px;
        }

        .step-description {
            color: #666;
            font-size: 14px;
        }

        /* è¶£å‘³æµ‹è¯•æè¿° */
        .test-description {
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .description-content {
            line-height: 1.8;
            color: #666;
            white-space: pre-line;
        }

        /* è¡ŒåŠ¨åŒºåŸŸ */
        .action-section {
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 40px;
        }

        .primary-btn {
            background: linear-gradient(135deg, #00B894, #00CEC9);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            max-width: 280px;
            margin-bottom: 15px;
        }

        .redeem-link {
            margin-top: 10px;
        }

        .redeem-link a {
            color: #00B894;
            text-decoration: none;
            font-size: 14px;
        }

        /* é¡µè„š */
        .page-footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 12px;
            width: 100%;
            max-width: 750px;
            margin: 0 auto;
        }

        /* === æ¡Œé¢ç«¯æ ·å¼ === */
        @media (min-width: 769px) {
            body {
                display: flex;
                justify-content: center;
                align-items: flex-start;
                background: linear-gradient(135deg, #F8FDFB 0%, #F0F9F7 100%);
                padding: 20px;
                min-height: 100vh;
            }

            .page-container {
                max-width: 750px;
                width: 100%;
                min-height: auto;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }

            .navbar {
                border-radius: 12px 12px 0 0;
            }

            .test-cover {
                border-radius: 0;
            }

            .page-footer {
                border-radius: 0 0 12px 12px;
            }
        }

        /* === ç§»åŠ¨ç«¯æ ·å¼ === */
        @media (max-width: 768px) {
            body {
                display: block;
                padding: 0;
                background: linear-gradient(135deg, #F8FDFB 0%, #F0F9F7 100%);
            }

            .page-container {
                max-width: 100%;
                border-radius: 0;
                box-shadow: none;
            }

            .basic-info-section,
            .test-description,
            .theory-section,
            .requirements-section,
            .report-example-section,
            .action-section {
                padding: 15px;
                margin-bottom: 10px;
            }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .basic-info-cards {
                gap: 10px;
            }
            
            .info-card {
                padding: 10px;
            }
            
            .report-steps {
                gap: 10px;
            }
            
            .step-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .step-title {
                margin-bottom: 5px;
            }
            
            .primary-btn {
                padding: 12px 30px;
                font-size: 16px;
            }
        }

        /* å†…å®¹åŠ è½½åŠ¨ç”» */
        .test-cover,
        .basic-info-section,
        .test-description,
        .theory-section,
        .requirements-section,
        .report-example-section,
        .action-section {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .content-loaded .test-cover,
        .content-loaded .basic-info-section, 
        .content-loaded .test-description,
        .content-loaded .theory-section,
        .content-loaded .requirements-section,
        .content-loaded .report-example-section,
        .content-loaded .action-section {
            opacity: 1;
        }
    </style>
</body>
</html>