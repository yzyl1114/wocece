<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>测试结果 - 我测测</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="container">
        <!-- 顶部导航 -->
        <nav class="navbar">
            <div class="logo" onclick="window.history.back()">← 返回</div>
        </nav>

        <!-- 结果头部 -->
        <section class="result-header">
            <div class="result-title">测试完成</div>
            <div class="result-score">
                <div class="score-circle">
                    <span id="totalScore">85</span>分
                </div>
                <div class="score-label">综合评分</div>
            </div>
        </section>

        <!-- 详细结果分析（趣味测试） -->
        <section class="analysis-section fun-analysis" id="funAnalysis">
            <h3>详细结果分析</h3>
            <div class="analysis-content" id="analysisText"></div>
        </section>

        <!-- 多维度报告（标准测试） -->
        <section class="dimensions-section standard-analysis" id="standardAnalysis">
            <h3>多维度详细报告</h3>
            
            <!-- 雷达图容器 -->
            <div class="radar-chart-container">
                <canvas id="radarChart" width="300" height="300"></canvas>
            </div>

            <!-- 维度分析 -->
            <div class="dimensions-list" id="dimensionsList">
                <!-- 动态生成 -->
            </div>

            <!-- 总结评语 -->
            <div class="summary-section">
                <h4>总结评语</h4>
                <div class="summary-content" id="summaryText"></div>
            </div>
        </section>

        <!-- 行动按钮 -->
        <section class="result-actions">
            <button id="retestBtn" class="action-btn secondary">再测一次</button>
            <button onclick="app.navigateTo('index.html')" class="action-btn primary">回首页</button>
        </section>

        <!-- 更多推荐 -->
        <section class="recommendations">
            <h3>更多推荐</h3>
            <div class="test-list" id="recommendationList">
                <!-- 动态生成 -->
            </div>
        </section>

        <!-- 页脚 -->
        <footer style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
            *本小程序仅供娱乐*
        </footer>
    </div>

    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script>
        class ResultManager {
            constructor() {
                this.testId = null;
                this.resultData = null;
                this.testType = null;
                this.init();
            }

            init() {
                this.testId = new URLSearchParams(window.location.search).get('id');
                this.loadResultData();
                this.renderResult();
                this.bindEvents();
                this.loadRecommendations();
            }

            loadResultData() {
                // 从URL参数获取结果数据
                const resultParam = new URLSearchParams(window.location.search).get('result');
                if (resultParam) {
                    this.resultData = JSON.parse(decodeURIComponent(resultParam));
                } else {
                    // 默认数据（测试用）
                    this.resultData = {
                        score: 85,
                        analysis: '基于你的答题情况分析，你是一个善于思考且情感丰富的人。在人际交往中表现出色，但有时可能过于在意他人看法。建议多关注自己的内心需求，保持独立思考。',
                        dimensions: [
                            { name: '个性分析', score: 85, analysis: '你具有独特的个性魅力，善于表达自己的想法。' },
                            { name: '控制自我', score: 72, analysis: '在情绪管理方面表现良好，但仍有提升空间。' },
                            { name: '调节自我', score: 68, analysis: '适应能力较强，能够快速调整状态。' },
                            { name: '平衡冲突', score: 79, analysis: '处理矛盾时能够保持理性，寻求平衡解决方案。' }
                        ],
                        summary: '总体而言，你是一个平衡发展的个体，在多个维度都表现出色。继续保持自我觉察，你会获得更好的个人成长。'
                    };
                }

                // 判断测试类型
                this.testType = this.resultData.testType === 'scl90' ? 'scl90' : 
                               (this.resultData.dimensions ? 'standard' : 'fun');
            }

            renderResult() {
                // 更新总分
                document.getElementById('totalScore').textContent = this.resultData.score;

                // 根据测试类型显示不同的报告样式
                if (this.testType === 'scl90') {
                    this.renderSCL90Result();
                } else if (this.testType === 'fun') {
                    this.renderFunResult();
                } else {
                    this.renderStandardResult();
                }
            }

            renderSCL90Result() {
                // 使用标准报告结构，隐藏趣味分析
                document.getElementById('funAnalysis').style.display = 'none';
                document.getElementById('standardAnalysis').style.display = 'block';
                
                // 更新分析内容
                document.getElementById('analysisText').textContent = this.resultData.analysis || '基于SCL-90症状自评量表的专业心理健康分析';
                
                // 如果有维度数据，渲染标准维度报告
                if (this.resultData.dimensions) {
                    this.renderStandardDimensions();
                }
                
                // 更新总结
                document.getElementById('summaryText').textContent = this.resultData.summary || '建议根据具体评估结果关注心理健康，必要时寻求专业帮助。';
            }
                
            renderFunResult() {
                // 显示趣味测试报告
                document.getElementById('funAnalysis').style.display = 'block';
                document.getElementById('standardAnalysis').style.display = 'none';
                
                document.getElementById('analysisText').textContent = this.resultData.analysis;
            }

            renderStandardResult() {
                // 显示标准测试报告
                document.getElementById('funAnalysis').style.display = 'none';
                document.getElementById('standardAnalysis').style.display = 'block';

                // 渲染分析文本
                document.getElementById('analysisText').textContent = this.resultData.analysis;

                // 渲染维度列表
                const dimensionsList = document.getElementById('dimensionsList');
                if (this.resultData.dimensions && this.resultData.dimensions.length > 0) {
                    dimensionsList.innerHTML = this.resultData.dimensions.map(dim => `
                        <div class="dimension-item">
                            <div class="dimension-header">
                                <span class="dimension-name">${dim.name}</span>
                                <span class="dimension-score">${dim.score}%</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-progress" style="width: ${dim.score}%"></div>
                            </div>
                            <div class="dimension-analysis">${dim.analysis}</div>
                        </div>
                    `).join('');
                }

                // 渲染总结
                document.getElementById('summaryText').textContent = this.resultData.summary;

                // 渲染雷达图
                this.renderRadarChart();
            }

            renderRadarChart() {
                if (!this.resultData.dimensions || this.resultData.dimensions.length === 0) {
                    document.querySelector('.radar-chart-container').style.display = 'none';
                    return;
                }

                const canvas = document.getElementById('radarChart');
                const ctx = canvas.getContext('2d');
                
                // 清除画布
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(centerX, centerY) - 20;
                const dimensions = this.resultData.dimensions;
                const angleStep = (2 * Math.PI) / dimensions.length;

                // 绘制网格
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                
                // 绘制同心圆
                for (let i = 1; i <= 5; i++) {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius * i / 5, 0, 2 * Math.PI);
                    ctx.stroke();
                }

                // 绘制维度线
                ctx.strokeStyle = '#ccc';
                for (let i = 0; i < dimensions.length; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    const x = centerX + radius * Math.cos(angle);
                    const y = centerY + radius * Math.sin(angle);
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // 绘制维度标签
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const labelX = centerX + (radius + 20) * Math.cos(angle);
                    const labelY = centerY + (radius + 20) * Math.sin(angle);
                    ctx.fillText(dimensions[i].name, labelX, labelY);
                }

                // 绘制数据多边形
                ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 2;
                ctx.beginPath();

                for (let i = 0; i < dimensions.length; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    const valueRadius = radius * (dimensions[i].score / 100);
                    const x = centerX + valueRadius * Math.cos(angle);
                    const y = centerY + valueRadius * Math.sin(angle);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
            }

            bindEvents() {
                document.getElementById('retestBtn').addEventListener('click', () => {
                    this.retest();
                });
            }

            retest() {
                window.location.href = `testing.html?id=${this.testId}`;
            }

            loadRecommendations() {
                // 从所有测试中随机选择3个（排除当前测试）
                const allTests = [
                    { id: '1', title: '性格色彩测试', description: '了解你的性格色彩，发现真实的自己', image: 'images/test1.jpg' },
                    { id: '2', title: '心理年龄测试', description: '测测你的心理年龄是多少', image: 'images/test2.jpg' },
                    { id: '3', title: '焦虑水平测试', description: '评估你的焦虑程度和应对方式', image: 'images/test3.jpg' },
                    { id: '4', title: '职业倾向测试', description: '发现最适合你的职业方向', image: 'images/test4.jpg' },
                    { id: '5', title: '情绪管理测试', description: '了解你的情绪管理能力', image: 'images/test5.jpg' },
                    { id: '6', title: 'SCL-90心理健康测试', description: '专业心理健康筛查，评估9大心理症状维度', image: 'images/scl90.jpg' }
                ];

                // 过滤掉当前测试
                const availableTests = allTests.filter(test => test.id !== this.testId);
                
                // 随机选择3个测试
                const recommendations = this.shuffleArray(availableTests).slice(0, 3);

                const container = document.getElementById('recommendationList');
                container.innerHTML = recommendations.map(rec => `
                    <div class="test-list-item" data-test-id="${rec.id}">
                        <div class="test-thumb" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
                        <div class="test-info">
                            <div class="test-title">${rec.title}</div>
                            <div class="test-desc">${rec.description}</div>
                        </div>
                        <button class="small-btn">前往</button>
                    </div>
                `).join('');

                // 绑定推荐项点击事件
                container.querySelectorAll('.test-list-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('small-btn')) {
                            const testId = item.dataset.testId;
                            window.location.href = `detail.html?id=${testId}`;
                        }
                    });
                });

                container.querySelectorAll('.small-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const testId = btn.closest('.test-list-item').dataset.testId;
                        window.location.href = `detail.html?id=${testId}`;
                    });
                });
            }

            // 随机打乱数组
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
        }

        // 初始化结果页面
        document.addEventListener('DOMContentLoaded', () => {
            window.resultManager = new ResultManager();
        });
    </script>

    <style>
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border-bottom: 1px solid var(--border-color);
        }

        .result-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin: -15px -15px 20px -15px;
        }

        .result-title {
            font-size: 20px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            background: rgba(255,255,255,0.1);
        }

        .score-circle span {
            font-size: 28px;
            font-weight: bold;
        }

        .score-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .analysis-section, .dimensions-section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .analysis-section h3, .dimensions-section h3 {
            color: #333;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .analysis-content {
            line-height: 1.8;
            color: #666;
            text-align: justify;
        }

        .radar-chart-container {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
        }

        .dimension-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .dimension-name {
            font-weight: bold;
            color: #333;
        }

        .dimension-score {
            color: #667eea;
            font-weight: bold;
        }

        .dimension-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .dimension-progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 1s ease;
        }

        .dimension-analysis {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .summary-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .summary-section h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .summary-content {
            color: #666;
            line-height: 1.8;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .action-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .recommendations {
            margin: 30px 0;
        }

        .recommendations h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        /* 响应式调整 */
        @media (max-width: 480px) {
            .score-circle {
                width: 80px;
                height: 80px;
            }
            
            .score-circle span {
                font-size: 24px;
            }
            
            .result-actions {
                flex-direction: column;
            }
        }

        /* SCL-90专用样式 */
        .high-score {
            border-left: 4px solid #ff4757;
            background: #fff5f5;
        }

        .high-text {
            color: #ff4757;
            font-weight: bold;
        }

        .dim-desc {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .dim-range {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .scl90-summary {
            line-height: 1.6;
        }

        .assessment-level {
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .assessment-level.严重 {
            background: #fff5f5;
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        .assessment-level.明显 {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .assessment-level.关注 {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .assessment-level.正常 {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .assessment-desc, .assessment-suggestion {
            margin-bottom: 10px;
            padding: 8px 0;
        }

        .high-factors {
            background: #fff5f5;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #ff4757;
        }

        .factor-suggestion {
            color: #ff4757;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .scl90-note {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
            margin-top: 15px;
            border-left: 3px solid #667eea;
        }

        /* 响应式调整 */
        @media (max-width: 480px) {
            .dim-desc {
                font-size: 11px;
            }
            
            .assessment-level {
                padding: 6px 10px;
                font-size: 14px;
            }
        }

    </style>
</body>
</html>