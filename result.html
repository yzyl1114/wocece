<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æµ‹è¯•ç»“æœ - æˆ‘æµ‹æµ‹</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <nav class="navbar">
            <div class="logo" onclick="window.history.back()">â† è¿”å›</div>
            <div class="nav-icon">â­</div>
        </nav>

        <!-- ç»“æœå¤´éƒ¨ -->
        <section class="result-header">
            <div class="result-title">æµ‹è¯•å®Œæˆ</div>
            <div class="result-score">
                <div class="score-circle">
                    <span id="totalScore">85</span>åˆ†
                </div>
                <div class="score-label">ç»¼åˆè¯„åˆ†</div>
            </div>
        </section>

        <!-- è¯¦ç»†ç»“æœåˆ†æï¼ˆè¶£å‘³æµ‹è¯•ï¼‰ -->
        <section class="analysis-section fun-analysis" id="funAnalysis">
            <h3>è¯¦ç»†ç»“æœåˆ†æ</h3>
            <div class="analysis-content" id="analysisText"></div>
        </section>

        <!-- å¤šç»´åº¦æŠ¥å‘Šï¼ˆæ ‡å‡†æµ‹è¯•ï¼‰ -->
        <section class="dimensions-section standard-analysis" id="standardAnalysis">
            <h3>å¤šç»´åº¦è¯¦ç»†æŠ¥å‘Š</h3>
            
            <!-- é›·è¾¾å›¾å®¹å™¨ -->
            <div class="radar-chart-container">
                <canvas id="radarChart" width="300" height="300"></canvas>
            </div>

            <!-- ç»´åº¦åˆ†æ -->
            <div class="dimensions-list" id="dimensionsList">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- æ€»ç»“è¯„è¯­ -->
            <div class="summary-section">
                <h4>æ€»ç»“è¯„è¯­</h4>
                <div class="summary-content" id="summaryText"></div>
            </div>
        </section>

        <!-- è¡ŒåŠ¨æŒ‰é’® -->
        <section class="result-actions">
            <button id="retestBtn" class="action-btn secondary">å†æµ‹ä¸€æ¬¡</button>
            <button onclick="app.navigateTo('index.html')" class="action-btn primary">æ›´å¤šæµ‹è¯•</button>
        </section>

        <!-- æ›´å¤šæ¨è -->
        <section class="recommendations">
            <h3>æ›´å¤šæ¨è</h3>
            <div class="recommendation-list" id="recommendationList">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer style="text-align: center; padding: 20px; color: #666; font-size: 12px;">
            *æœ¬å°ç¨‹åºä»…ä¾›å¨±ä¹*
        </footer>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <div class="nav-item" data-target="index.html">
            <div class="nav-icon">ğŸ </div>
            <div>é¦–é¡µ</div>
        </div>
        <div class="nav-item" data-target="discover.html">
            <div class="nav-icon">ğŸ”</div>
            <div>å‘ç°</div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/storage.js"></script>
    <script>
        class ResultManager {
            constructor() {
                this.testId = null;
                this.resultData = null;
                this.testType = null;
                this.init();
            }

            init() {
                this.testId = new URLSearchParams(window.location.search).get('id');
                this.loadResultData();
                this.renderResult();
                this.bindEvents();
                this.loadRecommendations();
            }

            loadResultData() {
                // ä»URLå‚æ•°è·å–ç»“æœæ•°æ®
                const resultParam = new URLSearchParams(window.location.search).get('result');
                if (resultParam) {
                    this.resultData = JSON.parse(decodeURIComponent(resultParam));
                } else {
                    // é»˜è®¤æ•°æ®ï¼ˆæµ‹è¯•ç”¨ï¼‰
                    this.resultData = {
                        score: 85,
                        analysis: 'åŸºäºä½ çš„ç­”é¢˜æƒ…å†µåˆ†æï¼Œä½ æ˜¯ä¸€ä¸ªå–„äºæ€è€ƒä¸”æƒ…æ„Ÿä¸°å¯Œçš„äººã€‚åœ¨äººé™…äº¤å¾€ä¸­è¡¨ç°å‡ºè‰²ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºåœ¨æ„ä»–äººçœ‹æ³•ã€‚å»ºè®®å¤šå…³æ³¨è‡ªå·±çš„å†…å¿ƒéœ€æ±‚ï¼Œä¿æŒç‹¬ç«‹æ€è€ƒã€‚',
                        dimensions: [
                            { name: 'ä¸ªæ€§åˆ†æ', score: 85, analysis: 'ä½ å…·æœ‰ç‹¬ç‰¹çš„ä¸ªæ€§é­…åŠ›ï¼Œå–„äºè¡¨è¾¾è‡ªå·±çš„æƒ³æ³•ã€‚' },
                            { name: 'æ§åˆ¶è‡ªæˆ‘', score: 72, analysis: 'åœ¨æƒ…ç»ªç®¡ç†æ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œä½†ä»æœ‰æå‡ç©ºé—´ã€‚' },
                            { name: 'è°ƒèŠ‚è‡ªæˆ‘', score: 68, analysis: 'é€‚åº”èƒ½åŠ›è¾ƒå¼ºï¼Œèƒ½å¤Ÿå¿«é€Ÿè°ƒæ•´çŠ¶æ€ã€‚' },
                            { name: 'å¹³è¡¡å†²çª', score: 79, analysis: 'å¤„ç†çŸ›ç›¾æ—¶èƒ½å¤Ÿä¿æŒç†æ€§ï¼Œå¯»æ±‚å¹³è¡¡è§£å†³æ–¹æ¡ˆã€‚' }
                        ],
                        summary: 'æ€»ä½“è€Œè¨€ï¼Œä½ æ˜¯ä¸€ä¸ªå¹³è¡¡å‘å±•çš„ä¸ªä½“ï¼Œåœ¨å¤šä¸ªç»´åº¦éƒ½è¡¨ç°å‡ºè‰²ã€‚ç»§ç»­ä¿æŒè‡ªæˆ‘è§‰å¯Ÿï¼Œä½ ä¼šè·å¾—æ›´å¥½çš„ä¸ªäººæˆé•¿ã€‚'
                    };
                }

                // åˆ¤æ–­æµ‹è¯•ç±»å‹ï¼ˆç®€å•é€»è¾‘ï¼Œå®é™…åº”è¯¥ä»æµ‹è¯•æ•°æ®è·å–ï¼‰
                this.testType = this.resultData.dimensions ? 'standard' : 'fun';
            }

            renderResult() {
                // æ›´æ–°æ€»åˆ†
                document.getElementById('totalScore').textContent = this.resultData.score;

                // æ ¹æ®æµ‹è¯•ç±»å‹æ˜¾ç¤ºä¸åŒçš„æŠ¥å‘Šæ ·å¼
                if (this.testType === 'fun') {
                    this.renderFunResult();
                } else {
                    this.renderStandardResult();
                }
            }

            // æ–°å¢ï¼šSCL-90ç»“æœæ¸²æŸ“
            renderSCL90Result() {
                const result = this.resultData;
                
                // éšè—è¶£å‘³åˆ†æï¼Œæ˜¾ç¤ºæ ‡å‡†åˆ†æ
                document.getElementById('funAnalysis').style.display = 'none';
                document.getElementById('standardAnalysis').style.display = 'block';
                
                // æ›´æ–°æ ‡é¢˜
                document.querySelector('.result-title').textContent = 'SCL-90æµ‹è¯„å®Œæˆ';
                
                // æ›´æ–°æ€»åˆ†æ˜¾ç¤º
                document.getElementById('totalScore').textContent = result.totalScore;
                document.querySelector('.score-label').textContent = 'æ€»åˆ†';

                // æ¸²æŸ“å„ç»´åº¦åˆ†æ•°
                const dimensionsList = document.getElementById('dimensionsList');
                dimensionsList.innerHTML = Object.keys(result.dimensions).map(dimKey => {
                    const dim = result.dimensions[dimKey];
                    const percentage = (dim.averageScore / 5) * 100;
                    return `
                        <div class="dimension-item ${dim.isHigh ? 'high-score' : ''}">
                            <div class="dimension-header">
                                <span class="dimension-name">${dim.name}</span>
                                <span class="dimension-score">${dim.averageScore.toFixed(2)}åˆ†</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-progress" style="width: ${percentage}%"></div>
                            </div>
                            <div class="dimension-analysis">
                                <div class="dim-desc">${dim.description}</div>
                                <div class="dim-result ${dim.isHigh ? 'high-text' : ''}">
                                    ${dim.isHigh ? dim.highDescription : dim.lowDescription}
                                </div>
                                <div class="dim-range">åˆ†æ•°èŒƒå›´ï¼š${dim.scoreRange[0]} - ${dim.scoreRange[1]}åˆ†</div>
                            </div>
                        </div>
                    `;
                }).join('');

                // æ¸²æŸ“æ€»ä½“è¯„ä¼°
                const assessment = result.overallAssessment;
                document.getElementById('summaryText').innerHTML = `
                    <div class="scl90-summary">
                        <div class="assessment-level ${assessment.level}">
                            <strong>è¯„ä¼°ç­‰çº§ï¼š</strong>${assessment.level}
                        </div>
                        <div class="assessment-desc">
                            <strong>æ€»ä½“æè¿°ï¼š</strong>${assessment.description}
                        </div>
                        <div class="assessment-suggestion">
                            <strong>å»ºè®®ï¼š</strong>${assessment.suggestion}
                        </div>
                        ${assessment.hasHighFactors ? `
                            <div class="high-factors">
                                <strong>é‡ç‚¹å…³æ³¨ç»´åº¦ï¼š</strong>${assessment.highFactors.join('ã€')}
                            </div>
                            <div class="factor-suggestion">
                                ${assessment.factorSuggestion}
                            </div>
                        ` : ''}
                        <div class="scl90-note">
                            <em>æ³¨ï¼šæ€»åˆ†è¶…è¿‡160åˆ†æˆ–ä»»ä¸€å› å­åˆ†è¶…è¿‡2åˆ†å»ºè®®è¿›ä¸€æ­¥æ£€æŸ¥</em>
                        </div>
                    </div>
                `;

                // éšè—é›·è¾¾å›¾
                document.querySelector('.radar-chart-container').style.display = 'none';
            }

            renderFunResult() {
                // æ˜¾ç¤ºè¶£å‘³æµ‹è¯•æŠ¥å‘Š
                document.getElementById('funAnalysis').style.display = 'block';
                document.getElementById('standardAnalysis').style.display = 'none';
                
                document.getElementById('analysisText').textContent = this.resultData.analysis;
            }

            renderStandardResult() {
                // æ˜¾ç¤ºæ ‡å‡†æµ‹è¯•æŠ¥å‘Š
                document.getElementById('funAnalysis').style.display = 'none';
                document.getElementById('standardAnalysis').style.display = 'block';

                // æ¸²æŸ“åˆ†ææ–‡æœ¬
                document.getElementById('analysisText').textContent = this.resultData.analysis;

                // æ¸²æŸ“ç»´åº¦åˆ—è¡¨
                const dimensionsList = document.getElementById('dimensionsList');
                dimensionsList.innerHTML = this.resultData.dimensions.map(dim => `
                    <div class="dimension-item">
                        <div class="dimension-header">
                            <span class="dimension-name">${dim.name}</span>
                            <span class="dimension-score">${dim.score}%</span>
                        </div>
                        <div class="dimension-bar">
                            <div class="dimension-progress" style="width: ${dim.score}%"></div>
                        </div>
                        <div class="dimension-analysis">${dim.analysis}</div>
                    </div>
                `).join('');

                // æ¸²æŸ“æ€»ç»“
                document.getElementById('summaryText').textContent = this.resultData.summary;

                // æ¸²æŸ“é›·è¾¾å›¾
                this.renderRadarChart();
            }

            renderRadarChart() {
                const canvas = document.getElementById('radarChart');
                const ctx = canvas.getContext('2d');
                
                // æ¸…é™¤ç”»å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = Math.min(centerX, centerY) - 20;
                const dimensions = this.resultData.dimensions;
                const angleStep = (2 * Math.PI) / dimensions.length;

                // ç»˜åˆ¶ç½‘æ ¼
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 1;
                
                // ç»˜åˆ¶åŒå¿ƒåœ†
                for (let i = 1; i <= 5; i++) {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius * i / 5, 0, 2 * Math.PI);
                    ctx.stroke();
                }

                // ç»˜åˆ¶ç»´åº¦çº¿
                ctx.strokeStyle = '#ccc';
                for (let i = 0; i < dimensions.length; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    const x = centerX + radius * Math.cos(angle);
                    const y = centerY + radius * Math.sin(angle);
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // ç»˜åˆ¶ç»´åº¦æ ‡ç­¾
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const labelX = centerX + (radius + 20) * Math.cos(angle);
                    const labelY = centerY + (radius + 20) * Math.sin(angle);
                    ctx.fillText(dimensions[i].name, labelX, labelY);
                }

                // ç»˜åˆ¶æ•°æ®å¤šè¾¹å½¢
                ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 2;
                ctx.beginPath();

                for (let i = 0; i < dimensions.length; i++) {
                    const angle = i * angleStep - Math.PI / 2;
                    const valueRadius = radius * (dimensions[i].score / 100);
                    const x = centerX + valueRadius * Math.cos(angle);
                    const y = centerY + valueRadius * Math.sin(angle);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
            }

            bindEvents() {
                document.getElementById('retestBtn').addEventListener('click', () => {
                    this.retest();
                });
            }

            retest() {
                window.location.href = `testing.html?id=${this.testId}`;
            }

            loadRecommendations() {
                // æ¨¡æ‹Ÿæ¨èæ•°æ®
                const recommendations = [
                    { id: '2', title: 'å¿ƒç†å¹´é¾„æµ‹è¯•', description: 'æµ‹æµ‹ä½ çš„å¿ƒç†å¹´é¾„æ˜¯å¤šå°‘', image: 'images/test2.jpg' },
                    { id: '3', title: 'æƒ…ç»ªç®¡ç†æµ‹è¯•', description: 'äº†è§£ä½ çš„æƒ…ç»ªç®¡ç†èƒ½åŠ›', image: 'images/test3.jpg' },
                    { id: '4', title: 'èŒä¸šå€¾å‘æµ‹è¯•', description: 'å‘ç°é€‚åˆä½ çš„èŒä¸šæ–¹å‘', image: 'images/test4.jpg' }
                ];

                const container = document.getElementById('recommendationList');
                container.innerHTML = recommendations.map(rec => `
                    <div class="recommendation-item" data-test-id="${rec.id}">
                        <img src="${rec.image}" alt="${rec.title}" class="rec-image">
                        <div class="rec-content">
                            <div class="rec-title">${rec.title}</div>
                            <div class="rec-desc">${rec.description}</div>
                            <button class="rec-btn">å‰å¾€æµ‹è¯•</button>
                        </div>
                    </div>
                `).join('');

                // ç»‘å®šæ¨èé¡¹ç‚¹å‡»äº‹ä»¶
                container.querySelectorAll('.recommendation-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('rec-btn')) {
                            const testId = item.dataset.testId;
                            window.location.href = `detail.html?id=${testId}`;
                        }
                    });
                });

                container.querySelectorAll('.rec-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const testId = btn.closest('.recommendation-item').dataset.testId;
                        window.location.href = `detail.html?id=${testId}`;
                    });
                });
            }
        }

        // åˆå§‹åŒ–ç»“æœé¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            window.resultManager = new ResultManager();
        });
    </script>

    <style>
        .result-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin: -15px -15px 20px -15px;
        }

        .result-title {
            font-size: 20px;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            background: rgba(255,255,255,0.1);
        }

        .score-circle span {
            font-size: 28px;
            font-weight: bold;
        }

        .score-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .analysis-section, .dimensions-section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .analysis-section h3, .dimensions-section h3 {
            color: #333;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .analysis-content {
            line-height: 1.8;
            color: #666;
            text-align: justify;
        }

        .radar-chart-container {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
        }

        .dimension-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .dimension-name {
            font-weight: bold;
            color: #333;
        }

        .dimension-score {
            color: #667eea;
            font-weight: bold;
        }

        .dimension-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .dimension-progress {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 1s ease;
        }

        .dimension-analysis {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .summary-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .summary-section h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .summary-content {
            color: #666;
            line-height: 1.8;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .action-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .recommendations {
            margin: 30px 0;
        }

        .recommendations h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .recommendation-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recommendation-item {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .recommendation-item:hover {
            transform: translateY(-2px);
        }

        .rec-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
        }

        .rec-content {
            flex: 1;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .rec-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .rec-desc {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .rec-btn {
            align-self: flex-start;
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .score-circle {
                width: 80px;
                height: 80px;
            }
            
            .score-circle span {
                font-size: 24px;
            }
            
            .result-actions {
                flex-direction: column;
            }
        }

        /* SCL-90ä¸“ç”¨æ ·å¼ */
        .high-score {
            border-left: 4px solid #ff4757;
            background: #fff5f5;
        }

        .high-text {
            color: #ff4757;
            font-weight: bold;
        }

        .dim-desc {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .dim-range {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .scl90-summary {
            line-height: 1.6;
        }

        .assessment-level {
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .assessment-level.ä¸¥é‡ {
            background: #fff5f5;
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        .assessment-level.æ˜æ˜¾ {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .assessment-level.å…³æ³¨ {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .assessment-level.æ­£å¸¸ {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .assessment-desc, .assessment-suggestion {
            margin-bottom: 10px;
            padding: 8px 0;
        }

        .high-factors {
            background: #fff5f5;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #ff4757;
        }

        .factor-suggestion {
            color: #ff4757;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .scl90-note {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
            margin-top: 15px;
            border-left: 3px solid #667eea;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .dim-desc {
                font-size: 11px;
            }
            
            .assessment-level {
                padding: 6px 10px;
                font-size: 14px;
            }
        }

    </style>
</body>
</html>